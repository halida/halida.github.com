
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>网络寻租</title>
  <meta name="author" content="机械唯物主义">

  
  <meta name="description" content="问题 我们的客户端程序庞大, 笨重, 更为严重的是, 当我们的程序发布给用户之后,
如果没有问题还好, 遇到了bug, 修改很成问题.
如何把更新后的程序发布给用户呢? 很多项目在做架构的时候,
选择采用web方式来绕过这样的问题. 但是很多时候还是非用客户端程序不可. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.linjunhalida.com/blog/page/10/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="网络寻租" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26509244-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">网络寻租</a></h1>
  
    <h2>Programmer, Gamer, Hacker</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.linjunhalida.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">博客</a></li>
  <li><a href="/blog/categories/english">English Blog</a></li>
  <li><a href="/about">关于我</a></li>
  <li><a href="/blog/archives">存档</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/online-update/">程序如何作在线更新</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-17T11:01:49+08:00" pubdate data-updated="true">Dec 17<span>th</span>, 2010</time>
        
         | <a href="/blog/online-update/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>问题</h2>

<p><img src="http://lh4.ggpht.com/_os_zrveP8Ns/TQrJ7IXV-_I/AAAAAAAADOU/AFzkVbp1W_8/s800/101118-Caribou-web.jpg" alt="image" /></p>

<p>我们的客户端程序庞大, 笨重, 更为严重的是, 当我们的程序发布给用户之后,
如果没有问题还好, 遇到了bug, 修改很成问题.
如何把更新后的程序发布给用户呢? 很多项目在做架构的时候,
选择采用web方式来绕过这样的问题. 但是很多时候还是非用客户端程序不可.
如何让客户端程序实现在线更新功能? 这里提供我的一个非常简单的解决方案.</p>

<h2>思路</h2>

<p>更新的业务逻辑很简单. 只需要下面几步:</p>

<ul>
<li>去某个服务器, 下载一个记录有版本信息的文档.</li>
<li>与本地程序的版本号做比较, 如果不是最新的, 提示用户更新程序.</li>
<li>更新程序的方法: 去服务器下载一个压缩包, 解压覆盖本地程序.</li>
</ul>


<p>然后是具体实现上面的逻辑.</p>

<h2>要点</h2>

<ul>
<li><p>服务器必须能够被客户访问到.</p>

<p>如果是在外网的话, 必须有一个存放更新文件的公共服务器. 我采用 <a href="http://code.google.com">google
code</a> 存放文件. 一个项目上传文件的限额是2G,
足够用了. 你也可以选择自己搭建一个http/ftp服务器,
或者用dropbox(被墙掉了), everbox(现在还不支持共享文件).</p></li>
<li><p>更新程序. 下载程序后, 需要覆盖当前程序目录, windows下面,
开启后的程序会加锁执行文件, 所以需要运行另外的一个程序来做更新.
下面是具体的逻辑.</p></li>
</ul>


<h2>更新程序解决方案</h2>

<p>比如旧程序在dir_a目录下面, 可执行文件是a.exe.
星号括起来的是当前正在执行的文件.</p>

<pre><code>dir_a: **a.exe**
</code></pre>

<p>我们把dir_a拷贝出一份, 到dir_backup, 最新的程序保存到dir_backup里面,
保存为new.tar.gz. 下载完毕后, 我们在dir_b里面建立一个文件,
叫need_update, 作为标识.</p>

<pre><code>dir_a: **a.exe**
dir_backup: a.exe, new.tar.gz, need_update
</code></pre>

<p>用 <a href="http://docs.python.org/library/os.html#os.execl">execl</a>
(c/c++/python/都可以用类似的函数调用), 关闭当前程序,
跳到dir_backup环境里面, 执行dir_backup/a.exe.</p>

<pre><code>dir_a: a.exe
dir_backup: **a.exe**, new.tar.gz, need_update
</code></pre>

<p>dir_backup/a.exe启动的时候检查当前目录下面是否有need_update, 有的话,
就解压new.tar.gz, 覆盖dir_a. 这个时候程序已经更新完成了.</p>

<pre><code>dir_a: new.exe
dir_backup: **a.exe**, new.tar.gz, need_update
</code></pre>

<p>然后再用 `execl`, 放弃当前程序, 执行dir_a/new.exe.</p>

<pre><code>dir_a: **new.exe**
dir_backup: a.exe, new.tar.gz, need_update
</code></pre>

<p>步骤虽然有点复杂, 但是顶用, 也不需要另外加一个更新程序.
对于python发布出去的代码来说, 一个可执行文件就上M了, 少一个是一个.</p>

<p>下面是实际代码, 因为是从实际项目中挖出来的, 保证不能用.
都是update.py这一个源文件的:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">qtlib</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">qtlib.download</span> <span class="kn">import</span> <span class="n">download</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">add_config</span><span class="p">,</span> <span class="n">conf</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">tools.progresser</span> <span class="kn">import</span> <span class="n">Progresser</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">tarfile</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">distutils.dir_util</span> <span class="kn">import</span> <span class="n">copy_tree</span>
</span><span class='line'><span class="n">SERVER</span> <span class="o">=</span> <span class="s">&quot;http://project.googlecode.com/files/&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;具体更新的方法&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">confirm</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;开始准备更新, 是否继续?&#39;</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># 检查是否有更新</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_update</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># 复制program</span>
</span><span class='line'>    <span class="n">temp_path</span> <span class="o">=</span> <span class="s">&#39;../</span><span class="si">%s</span><span class="s">.backup&#39;</span> <span class="o">%</span> <span class="n">program</span>
</span><span class='line'>    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;..&#39;</span><span class="p">,</span> <span class="n">program</span><span class="p">),</span>
</span><span class='line'>                    <span class="n">temp_path</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># 下载程序</span>
</span><span class='line'>    <span class="n">tar_file</span> <span class="o">=</span> <span class="n">program</span> <span class="o">+</span> <span class="s">&#39;.tar.gz&#39;</span>
</span><span class='line'>    <span class="n">local_tar_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="n">tar_file</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">with</span> <span class="n">Progresser</span><span class="p">(</span><span class="s">&quot;下载中, 比较忙, 你可以离开位置休息一下..&quot;</span><span class="p">,</span><span class="s">&quot;退出&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="n">download</span><span class="p">(</span><span class="n">SERVER</span> <span class="o">+</span> <span class="n">tar_file</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">local_tar_file</span><span class="p">,</span>
</span><span class='line'>                          <span class="n">stepper</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
</span><span class='line'>            <span class="n">showMsg</span><span class="p">(</span><span class="s">&quot;无法连接到服务器, 请检查是否连上外部网络!&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span>
</span><span class='line'>        <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>            <span class="n">showMsg</span><span class="p">(</span><span class="s">&#39;取消下载, 不好意思, 下次还得从头开始下载..&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">showMsg</span><span class="p">(</span><span class="s">&#39;下载完成, 现在安装新程序.&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
</span><span class='line'>    <span class="c"># 解压</span>
</span><span class='line'>    <span class="n">unzip</span><span class="p">(</span><span class="n">tar_file</span><span class="p">)</span>
</span><span class='line'>    <span class="c"># 标示一下是新程序</span>
</span><span class='line'>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;need_update&#39;</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
</span><span class='line'>    <span class="c"># 执行新程序</span>
</span><span class='line'>    <span class="n">program_name</span> <span class="o">=</span> <span class="n">program</span><span class="o">+</span><span class="s">&#39;.exe&#39;</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">execl</span><span class="p">(</span><span class="n">program_name</span><span class="p">,</span> <span class="n">program_name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">check_update</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;检查是否有更新&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="c"># 下载versions文件</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">download</span><span class="p">(</span><span class="n">SERVER</span><span class="o">+</span><span class="s">&#39;versions&#39;</span><span class="p">,</span> <span class="s">&#39;temp/versions&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
</span><span class='line'>        <span class="n">showMsg</span><span class="p">(</span><span class="s">&quot;无法连接到服务器, 请检查是否连上外部网络!&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">False</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># 读取里面的信息</span>
</span><span class='line'>    <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;temp/versions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>    <span class="c"># 格式是: program + 空格 + 版本号</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
</span><span class='line'>            <span class="n">new_version</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>            <span class="c"># 把版本号当作浮点来检查</span>
</span><span class='line'>            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_version</span><span class="p">):</span>
</span><span class='line'>                <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>            <span class="k">else</span><span class="p">:</span>
</span><span class='line'>                <span class="n">showMsg</span><span class="p">(</span><span class="s">&quot;程序已经是最新版本: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">check_finish_update</span><span class="p">():</span>
</span><span class='line'>    <span class="c"># 检查当前是否是需要更新的临时文件</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s">&#39;need_update&#39;</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>    <span class="c"># 读取程序名称</span>
</span><span class='line'>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;need_update&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>        <span class="n">program</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;need_update&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="c"># 然后把新程序复制回去</span>
</span><span class='line'>    <span class="n">old_path</span> <span class="o">=</span> <span class="s">&#39;../</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">program</span>
</span><span class='line'>    <span class="n">copy_tree</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">old_path</span><span class="p">)</span>
</span><span class='line'>    <span class="c"># 执行程序</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">old_path</span><span class="p">)</span>
</span><span class='line'>    <span class="n">program_name</span> <span class="o">=</span> <span class="n">program</span> <span class="o">+</span> <span class="s">&#39;.exe&#39;</span>
</span><span class='line'>    <span class="n">os</span><span class="o">.</span><span class="n">execl</span><span class="p">(</span><span class="n">program_name</span><span class="p">,</span> <span class="n">program_name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 加载update.py模块的时候, 判断当前是否为在backup过程中执行的..</span>
</span><span class='line'><span class="n">check_finish_update</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>其他</h2>

<p>基于上面的更新逻辑, 我们还可以根据需求, 补充一些功能:</p>

<ul>
<li>启动的时候检查更新. 只需要用threading.Thread(target=check_update,
&#8230;)来用一个线程跑更新检查就可以了.</li>
<li>后台更新. 也可以用一个线程跑下载, 下载完毕后, 再通知主线程.</li>
<li>增量更新, 减少下载时间. 可以考虑用diff之类工具.</li>
</ul>


<p>如果有人觉得这样的更新脚本有价值的话, 可以联系我,
让我整理出一份不依赖其他模块的代码出来.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/pyside/">Pyside介绍</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-08T22:37:34+08:00" pubdate data-updated="true">Dec 8<span>th</span>, 2010</time>
        
         | <a href="/blog/pyside/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>什么是pyside?</h2>

<p>`pyside`_ 是一个Qt4在python下面的绑定, 是PyQt4的取代.
它和PyQt4不同的地方是, 支持商业闭源应用, 以及是Qt4官方支持的.</p>

<h2>pyside现在状况怎么样?</h2>

<p>第一个beta版本已于2010/12/26释放. 处于火热开发中. pyside是完全跟进qt的.
beta里面带有qml的支持.</p>

<h2>如何获取pyside?</h2>

<p>如果你用ubuntu, 加一下ppa的源就好了. 网址:
<a href="https://launchpad.net/~pyside/+archive/ppa">https://launchpad.net/\~pyside/+archive/ppa</a></p>

<p>执行命令:</p>

<p>也可以去clone `pyside源码库`_.</p>

<h2>尝试pyside</h2>

<p>我们通过几个示例来看pyside的状况:</p>

<h2>简单示例</h2>

<p>一个简单的示例, pyside提供和pyqt API级别的互通, 方便pyqt用户迁移.
与pyqt代码的区别, 只在import的时候把PyQt4改成PySide就好了:</p>

<h2>UI</h2>

<p>看起来写代码还OK, 我们看一些其他的功能, 比如如何支持ui.
我们用qtdesigner写好了ui文件, 如何在pyside下面使用?</p>

<p>pyqt有几种方式:</p>

<ul>
<li><p>采用pyuic4把ui文件转换为python代码. pyside也有一个这样的工具,
名称是pyside-uic.(还有pyside-rcc, pyside-lupdate与pyqt对应)</p></li>
<li><p>代码中动态导入, pyqt的代码是这样写的:</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">form</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span><span class="s">&quot;score.ui&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ScoreDlg</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">ScoreDlg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>在pyside里面, 直接生成一个对象的方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">PySide.QtUiTools</span> <span class="kn">import</span> <span class="n">QUiLoader</span>
</span><span class='line'><span class="n">loader</span> <span class="o">=</span> <span class="n">QUiLoader</span><span class="p">()</span>
</span><span class='line'><span class="n">widget</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;mywidget.ui&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>我上pyside的maillist, 找到了动态生成的方式, 把代码放在这里吧:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">MyQUiLoader</span><span class="p">(</span><span class="n">QUiLoader</span><span class="p">):</span>
</span><span class='line'>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseinstance</span><span class="p">):</span>
</span><span class='line'>       <span class="nb">super</span><span class="p">(</span><span class="n">MyQUiLoader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class='line'>       <span class="bp">self</span><span class="o">.</span><span class="n">baseinstance</span> <span class="o">=</span> <span class="n">baseinstance</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">def</span> <span class="nf">createWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">className</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
</span><span class='line'>       <span class="n">widget</span> <span class="o">=</span> <span class="n">QUiLoader</span><span class="o">.</span><span class="n">createWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">className</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span class='line'>       <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>           <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseinstance</span>
</span><span class='line'>       <span class="k">else</span><span class="p">:</span>
</span><span class='line'>           <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseinstance</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">widget</span><span class="p">)</span>
</span><span class='line'>           <span class="k">return</span> <span class="n">widget</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">loadUi</span><span class="p">(</span><span class="n">uifile</span><span class="p">,</span> <span class="n">baseinstance</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>   <span class="n">loader</span> <span class="o">=</span> <span class="n">MyQUiLoader</span><span class="p">(</span><span class="n">baseinstance</span><span class="p">)</span>
</span><span class='line'>   <span class="n">ui</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">uifile</span><span class="p">)</span>
</span><span class='line'>   <span class="n">QMetaObject</span><span class="o">.</span><span class="n">connectSlotsByName</span><span class="p">(</span><span class="n">ui</span><span class="p">)</span>
</span><span class='line'>   <span class="k">return</span> <span class="n">ui</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后, 我们就可以用loadUi来扩展一个类了:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Inputer</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">Inputer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class='line'>        <span class="n">loadUi</span><span class="p">(</span><span class="s">&#39;draw.ui&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">leInput</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
</span><span class='line'>        <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<h2>QML, QML!</h2>

<p>pyside可以和qml一起使用, 不过我对qml不熟悉,
等以后熟悉了再来修改具体的示例吧. 你可以直接看 `pyside示例代码`_
里面关于declarative的部分.</p>

<h2>结论</h2>

<p>经过测试, pyside现在大致可用, 不过在一些地方会有bug, 现在是beta版本,
根据这个态势, 很快就能稳定了. 如果因为pyqt价格问题观望的同学,
现在可以下手pyside了, 也可以当当小白鼠, 为开源社区做点贡献(从我做起吧).</p>

<h2>资源</h2>

<ul>
<li><a href="http://www.pyside.org/">pyside</a> 官方网站</li>
<li><a href="http://developer.qt.nokia.com/wiki/PySideDocumentation/">pyside文档</a></li>
<li><a href="http://qt.gitorious.org/pyside/pyside-examples">pyside示例代码</a></li>
<li><a href="http://qt.gitorious.org/pyside">pyside源码库</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/python-declarative-programming/">简单python_宣告式编程</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-07T22:39:31+08:00" pubdate data-updated="true">Dec 7<span>th</span>, 2010</time>
        
         | <a href="/blog/python-declarative-programming/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>什么是宣告式编程?</h2>

<p><img src="http://i.ehow.com/images/a06/gg/32/declarative-statement_-800X800.jpg" alt="image" /></p>

<p>我们编程的时候, 往往是实现某个领域的业务逻辑, 而这些业务逻辑,
往往可以用定义的方式来表述. 程序员需要做的工作是,
如何把把这些业务逻辑的表述(信息), 用写程序的方式又好又快地实现出来.
如果你是一个资深程序员, 你会发现, 自己会从: 根据需求, 命令式地写代码,
控制机器一个动作又一个动作; 慢慢转移到: 用合适的文本描述需求,
然后想办法写个简单的解释器, 把这个文本转换为可执行的程序.
这种开发程序的方式, 我们叫它
<a href="http://zh.wikipedia.org/zh/%E5%AE%A3%E5%91%8A%E5%BC%8F%E7%B7%A8%E7%A8%8B">宣告式編程</a>.</p>

<p>大多数情况下, 我们会受到工具的限制, 不能很自然地完成这样的一个转换工作,
如果你有遇到这样的问题, 我建议你, 使用python作为编程语言.</p>

<h2>为什么用python?</h2>

<p>为了能够很好地支持宣告式編程, 我们需要满足几点:</p>

<ul>
<li><p>编程语言能够方便地完成数据结构的定义, 并能嵌入在代码当中.</p>

<p>python内嵌有list, dict, set等数据结构, 并且能够把它们组合起来,
搭建更复杂的结构. 而它们的定义, 是非常简单和清晰的:</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;me&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">address</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;shanghai&#39;</span><span class="p">,</span> <span class="s">&#39;chengdu&#39;</span><span class="p">],</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>也能够很方便地访问和修改这些数据结构.</p>

<p>python是动态语言, 不需要用户去具体处理资源分配的问题,
python会帮助处理这些琐碎的事情.</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;halida&#39;</span>
</span><span class='line'><span class="n">data</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;kunshang&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>并且能够根据这些数据结构动态地完成一些具体的操作.</p>

<p>python具有很高的动态特性, 能够在运行时动态生成, 修改对象的特性:</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">P</span><span class="p">():</span> <span class="k">pass</span>
</span><span class='line'><span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="p">()</span>
</span><span class='line'><span class="n">p</span><span class="o">.</span><span class="n">v</span> <span class="c"># 错误! p没有v</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 我们给它设置一个:</span>
</span><span class='line'><span class="n">P</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>
</span><span class='line'><span class="n">p</span><span class="o">.</span><span class="n">v</span> <span class="c"># --&gt; 12</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们具体去看一个示例吧.</p>

<h2>示例: 配置界面</h2>

<p>我们需要写一个简单的配置用户界面, 用户可以设置一些配置功能.
我们一开始的考虑是, 完全手写, 或者采用WYSIWYG工具,
拖拖拉拉把界面整理出来, 然后再写一个set/get的方法. 比方说, 这样写代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">ConfigDlg</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>         <span class="bp">self</span><span class="o">.</span><span class="n">leName</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
</span><span class='line'>         <span class="bp">self</span><span class="o">.</span><span class="n">sbValue</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">()</span>
</span><span class='line'>         <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span class='line'>         <span class="bp">self</span><span class="o">.</span><span class="n">leName</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
</span><span class='line'>         <span class="bp">self</span><span class="o">.</span><span class="n">sbValue</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">])</span>
</span><span class='line'>         <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">getUi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>         <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>         <span class="n">data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leName</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span class='line'>         <span class="n">data</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbValue</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
</span><span class='line'>         <span class="o">...</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">data</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是如果需求变动了怎么办? 如果配置需要添加, 修改?
那么我们就再去修改程序或者代码. 问题是, 程序写了有一段时间了,
变得陌生起来, 除非通读一遍, 不然很容易修改错. 并且代码有点散乱,
就像上面的代码, 在setUi里面写了逻辑, 如果在getUi里面忘记写了就麻烦了.</p>

<p>pythonic的一个原则: Simple is better than complex.
上面写代码的方式不能反映问题的本质, 我们需求的本质信息,
是我们需要配置什么内容, 以及这些内容应该用什么方式表现出来.
在上面的例子里面, 就是name和value. 我们用python数据结构的方式,
重新整理一遍需要配置的内容:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">CONFIG</span> <span class="o">=</span> <span class="p">(</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">unicode</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样是不是很清晰?</p>

<p>我们还要定义类型对应的控件, 以及具体处理数据的方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">TYPES</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span class='line'>    <span class="nb">unicode</span><span class="p">:</span> <span class="p">(</span><span class="n">QLineEdit</span><span class="p">,</span> <span class="s">&#39;setText&#39;</span><span class="p">,</span> <span class="s">&#39;text&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nb">int</span><span class="p">:</span> <span class="p">(</span><span class="n">QSpinBox</span><span class="p">,</span> <span class="s">&#39;setValue&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在我们需要把这样的配置转换为具体的界面, 下面就是具体转换的代码,
用命令式就很直截了当了:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">ConfigDlg</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>        <span class="k">for</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CONFIG</span><span class="p">:</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">TYPES</span><span class="p">[</span><span class="nb">type</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">type</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
</span><span class='line'>            <span class="n">w</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>            <span class="nb">getattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">types</span><span class="p">[</span><span class="nb">type</span><span class="p">][</span><span class="mi">1</span><span class="p">])(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">getUi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
</span><span class='line'>            <span class="n">w</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">value</span>
</span><span class='line'>            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">types</span><span class="p">[</span><span class="nb">type</span><span class="p">][</span><span class="mi">2</span><span class="p">])()</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">data</span>
</span></code></pre></td></tr></table></div></figure>


<p>要注意到, 我们能够这样&#8217;宣告式&#8217;地写设置内容, 有几个前提:</p>

<ul>
<li><p>设置部分的信息是属于变动的信息</p>

<p>我们实现一个宣告式的平台付出的代价能够被需求变动挽回的时间损失所弥补.
如果设置永远都不需要去改, 我们就没有必要这样设计了.
在上面的例子对应的真实需求里面, 开始的时候也是用最上面的方法来完成.
然后发生了需求变更, 再改成了后面宣告的方式.
这里也反映了python的一个优点: 代码足够少, 足够清晰,
能够非常方便和快速地重构掉.</p></li>
<li><p>基础是不变的</p>

<p>在上面的例子里面, 我们默认了一些前提:
这个设置见面是在一个QDialog里面, 如果要求配置是分类,
分多个QDialog怎么办? 这里我们需要进行一下预估,
什么信息是&#8217;泰山&#8217;一样永久不变, 什么信息是&#8217;羽毛&#8217;一样飘忽不定&#8230;
这个需要程序员对业务足够熟悉.</p></li>
</ul>


<h2>结论</h2>

<p>当我们需要实现一个功能的时候, 首先去探索, 这个功能的本质信息是那些?
这样的信息中, 那些是固定的? 哪些是变动的? 然后我们根据信息的本质属性,
选择对应的处理方式. 如果信息是经常变动的,
而它们变动的范围也是可以包括在一个问题域里面, 我们可以用宣告式编程,
来把他们描述出来. 不过, 如果这个问题域足够大, 足够精深,
我们恐怕要考虑专门做一门语言来包容它们了.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/scons/">Scons介绍</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-06T23:10:33+08:00" pubdate data-updated="true">Dec 6<span>th</span>, 2010</time>
        
         | <a href="/blog/scons/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>什么是scons?</h2>

<p><img src="http://www.gastronomiaycia.com/wp-content/uploads/2008/07/scones.jpg" alt="image" />
scons不是上面的小甜饼, 而是一个基于python的自动化构建工具.
和make一个性质. 不过, 更高级一些.</p>

<h2>为什么要用它呢?</h2>

<ul>
<li><p>高阶的make工具</p>

<p>make是不错, 但是太过简单了, 很多东西都要重复写, 很多事情都做不了..
我们需要一个更高级的工具.</p></li>
<li><p>python</p>

<p>既然我们要用更高级的工具, 去找找看: automake, cmake, qmake, ant..
已经有一堆东西了, 我们选择哪一个呢?</p>

<p>按照我的看法, 对于任何复杂的工具, 本质上来说,
都需要一个足够强大的编程语言来支持, 以便实现自动化和高可配置性.
既然python已经成为我的&#8221;main stream&#8221;语言, 当然要看支持python的工具了.
google python + make, 第一个结果就是scons了. 当然, 还有很多其他的
<a href="http://wiki.python.org/moin/ConfigurationAndBuildTools">pyghon构建工具</a>
可以选择.</p></li>
</ul>


<h2>安装</h2>

<ul>
<li>debian源:</li>
</ul>


<!-- -->


<pre><code>sudo apt-get install scons
</code></pre>

<ul>
<li>或者直接在安装了python的环境里面easy_install:</li>
</ul>


<!-- -->


<pre><code>eays_install scons
</code></pre>

<blockquote><p>对了, 如果在windows下面, easy_install安装后有可能出现: import error:
找不到Scons.Script. 我研究了一下, 发现在scons放的位置不对,
只要搜索下把scons的目录放到dist-packages文件夹里面就好了.</p></blockquote>

<h2>一个简单的示例</h2>

<p>我们直接去看一个示例吧, 目标是编译一个hello world c程序:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># 新建一个目录</span>
</span><span class='line'>rm t1 -rf; mkdir t1; <span class="nb">cd </span>t1
</span><span class='line'>
</span><span class='line'><span class="c"># 这里是我们的程序    </span>
</span><span class='line'>cat &gt; hello.c <span class="s">&lt;&lt;EOF</span>
</span><span class='line'><span class="s">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="s">int main(){</span>
</span><span class='line'><span class="s">    printf(&quot;hello, world!\n&quot;);</span>
</span><span class='line'><span class="s">    return 0;</span>
</span><span class='line'><span class="s">}</span>
</span><span class='line'><span class="s">EOF</span>
</span><span class='line'>
</span><span class='line'><span class="c"># scons的脚本文件名称是SConstruct/Sconstruct/sconstruct, 如果直接执行scons, 会按照上面的顺序找文件. 和make类似.</span>
</span><span class='line'>cat &gt; sconstruct <span class="s">&lt;&lt;EOF</span>
</span><span class='line'><span class="s"># sconstruct其实就是一个python脚本, 支持所有python能做的事情.</span>
</span><span class='line'><span class="s">BIN = &#39;hello&#39;</span>
</span><span class='line'><span class="s"># scons和其他构建工具一样, 是定义式的, 我们定义需要构建一个程序, 名称是BIN, 依赖hello.c</span>
</span><span class='line'><span class="s">Program(BIN, [&#39;hello.c&#39;])</span>
</span><span class='line'><span class="s"># 然后, 我们再定义一个执行的命令, 方便看结果. 它依赖BIN, 方法就是直接执行这个程序.</span>
</span><span class='line'><span class="s">Command(&#39;run&#39;, BIN, &#39;./&#39;+BIN)</span>
</span><span class='line'><span class="s">EOF</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 最后, 我们调用scons来执行run的命令.    </span>
</span><span class='line'>scons run
</span></code></pre></td></tr></table></div></figure>


<p>这里是结果:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>scons: Reading SConscript files ...
</span><span class='line'>scons: <span class="k">done </span>reading SConscript files.
</span><span class='line'>scons: Building targets ...
</span><span class='line'>gcc -o hello.o -c hello.c
</span><span class='line'>gcc -o hello hello.o
</span><span class='line'>./hello
</span><span class='line'>hello, world!
</span><span class='line'>scons: <span class="k">done </span>building targets.
</span></code></pre></td></tr></table></div></figure>


<p>scons会自动根据文件来调用对应的构建工具.</p>

<p>上面只是一个示例, 更多的最好去看 `scons官方文档`_.
文档有了我就不需要再写一遍了.</p>

<h2>我自己整理的一些重点</h2>

<p>我们可以构建:</p>

<ul>
<li>Program</li>
<li>Object</li>
<li>Library</li>
<li>SharedLibrary</li>
</ul>


<p>批量获取源文件:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Program</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">,</span> <span class="n">Glob</span><span class="p">(</span><span class="s">&#39;*.c&#39;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>设置参数: LIBS, LIBPATH, CCFLAGS, CPPPATH</p>

<p>我们可以设置一个环境:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">CC</span> <span class="o">=</span> <span class="s">&#39;gcc&#39;</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">CCFLAGS</span> <span class="o">=</span> <span class="s">&#39;-O2&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">env</span><span class="o">.</span><span class="n">Program</span><span class="p">(</span><span class="s">&#39;hello.c&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以设置判断是否修改的算法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># 默认采用算MD5的方法判断文件是否修改</span>
</span><span class='line'><span class="n">Decider</span><span class="p">(</span><span class="s">&#39;MD5&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c"># 可以设置传统的看timestamp是不是最新的方式</span>
</span><span class='line'><span class="n">Decider</span><span class="p">(</span><span class="s">&#39;timestamp-newer&#39;</span><span class="o">/</span><span class="n">make</span><span class="p">)</span> <span class="c">#</span>
</span><span class='line'><span class="c"># 也可以设置只要timestamp变了就算文件被修改了</span>
</span><span class='line'><span class="n">Decider</span><span class="p">(</span><span class="s">&#39;timestamp-match&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c"># 混合: timestamp改变了, MD5也变了才算修改了</span>
</span><span class='line'><span class="n">Decider</span><span class="p">(</span><span class="s">&#39;MD5-timestamp&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以根据Enviroment设置Decider</p>

<p>缓存判断依赖关系</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">SetOption</span><span class="p">(</span><span class="s">&#39;implicit_cache&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>设置依赖关系</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Depends</span><span class="p">(</span><span class="n">hello</span><span class="p">,</span> <span class="s">&#39;otherfile&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">Ignore</span><span class="p">(</span><span class="n">hello_obj</span><span class="p">,</span> <span class="s">&#39;hello.h&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>我最喜欢的, 执行自定义的命令:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Command</span><span class="p">(</span><span class="s">&#39;hello.o&#39;</span><span class="p">,</span> <span class="s">&#39;hello.c&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">[</span><span class="s">&#39;gcc $SOURCE -c&#39;</span><span class="p">,</span>
</span><span class='line'>         <span class="s">&#39;wc -l $SOURCE &gt;&gt; summary&#39;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<h2>结论</h2>

<p>看起来scons还是有点意思的, 我先用一段时间, 等有了一定的感觉之后再来看看.</p>

<h2>资源</h2>

<ul>
<li><a href="http://www.scons.org/doc/production/HTML/scons-user.html">scons官方文档</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/my-emacs-config/">我的emacs配置</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-04T20:48:50+08:00" pubdate data-updated="true">Dec 4<span>th</span>, 2010</time>
        
         | <a href="/blog/my-emacs-config/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>每个emacs使用者的配置都是不一样的, 都会根据自己的习惯和喜好来调整.
这里我整理一些对emacs用户调整有帮助的内容, 以及我自己觉得不错的配置.</p>

<h2>emacs配置如何管理?</h2>

<p>配置多了, 放在.emacs里面不是一回事, 我的解法是,
.emacs导入真正放配置的目录, 然后require:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(add-to-list 'load-path (expand-file-name "~/Dropbox/sync/emacs/srcs"))
</span><span class='line'>(load "main")</span></code></pre></td></tr></table></div></figure>


<p>main.el是配置的汇总, 配置按照模块和功能分割成不同的文件:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(provide 'main)
</span><span class='line'>
</span><span class='line'>;; requires
</span><span class='line'>(require 'mylib)
</span><span class='line'>(require 'template)
</span><span class='line'>(require 'mypython)
</span><span class='line'>(require 'mydired)
</span><span class='line'>(require 'myc)
</span><span class='line'>(require 'mykeymap)
</span><span class='line'>(require 'mygtd)
</span><span class='line'>(require 'top-mode)
</span><span class='line'>(require 'tabbar)
</span><span class='line'>(require 'fullscreen)</span></code></pre></td></tr></table></div></figure>


<p>dropbox是我同步emacs配置的工具, 你也可以用其他网盘工具.</p>

<h2>如何绑定自己的键位?</h2>

<p>每个emacs用户都会自己设定键位, 不会傻傻地M-x然后输入字符. 我个人的经验,
绑定键位的指导思想是: 对于显示buffer, 切换buffer之类使用非常频繁的功能,
找一些方便的直接键位来绑定, 比如:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(global-set-key [C-tab] 'other-window)</span></code></pre></td></tr></table></div></figure>


<p>对于一些其他不是那么频繁, 但是经常要使用的功能,
都可以绑定到间接键位上面. 我发现C-;没有使用, 按起来还很方便,
然后把所有自己定义的功能都加到上面去了:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(global-set-key (kbd "C-; 1") 'gtd)
</span><span class='line'>(global-set-key (kbd "C-; 2") 'note)
</span><span class='line'>(global-set-key (kbd "C-; 3") 'scratch)
</span><span class='line'>(global-set-key (kbd "C-; 4") 'py-shell)
</span><span class='line'>(global-set-key (kbd "C-; 5") 'woman)
</span><span class='line'>(global-set-key (kbd "C-; 7") 'twit-follow-recent-tweets)
</span><span class='line'>(global-set-key (kbd "C-; C-7") 'twit-post)</span></code></pre></td></tr></table></div></figure>


<p>对于针对某些mode的键位绑定, 只需要改变那个mode的键位就可以了:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(define-key dired-mode-map (kbd "b") 'dired-up-directory)</span></code></pre></td></tr></table></div></figure>


<h2>一定要设置的功能</h2>

<p>有些功能是如此的强大, 以至于缺少了他们emacs就不完整了..</p>

<ul>
<li><p><a href="http://www.emacswiki.org/emacs/InteractivelyDoThings">ido</a>,
如果你发现开启文件和切换buffer输入有点累的话, 用ido来节省输入.</p></li>
<li><p><a href="http://www.emacswiki.org/emacs/AutoComplete">auto-complete</a>
自动补全. 这里面的补全方案默认是取当前buffer的词语的,
对于我写python代码来说足够用了.
至于c/c++/java..等我写的时候再配置吧.</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(require 'auto-complete)
</span><span class='line'>(global-auto-complete-mode t)
</span><span class='line'>;; 匹配项目不用动手腕啦
</span><span class='line'>(define-key ac-complete-mode-map "\C-n" 'ac-next)
</span><span class='line'>(define-key ac-complete-mode-map "\C-p" 'ac-previous)</span></code></pre></td></tr></table></div></figure>


<ul>
<li>漂亮的配色. color-theme有一堆配色可以选的.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(require 'color-theme)
</span><span class='line'>(color-theme-arjen)</span></code></pre></td></tr></table></div></figure>


<p>还有一些零散的配置, 都放在
<a href="http://bitbucket.org/linjunhalida/emacs/src/tip/srcs/main.el">main.el</a>
里面.</p>

<ul>
<li><p>template 模板系统. 写东西怎么不能用模板呢.
一遍遍地输入同样的东西多烦. 我用的是
<a href="http://bitbucket.org/linjunhalida/emacs/src/tip/srcs/template.el">template.el</a>,
不过感觉用的不是很熟, 还要改改.</p></li>
<li><p><a href="http://orgmode.org/">org-mode</a>. 用来写notes/todo/gtd的. 看看吧,
功能强大.</p></li>
</ul>


<h2>其他有价值的东西</h2>

<ul>
<li>shell-command功能. 可以在buffer当前目录执行命令. 如果不想它卡死的话,
可以在命令后面加&amp;(linux).</li>
<li><a href="http://www.lysator.liu.se/~tab/artist/">artist-mode</a>,
可以在emacs里面画图.
<a href="http://www.cinsk.org/emacs/emacs-artist.html">artist-mode视频介绍</a></li>
<li>半透明. linux下面要开启特效才能半透明.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(set-frame-parameter (selected-frame) 'alpha '(80 50))
</span><span class='line'>(add-to-list 'default-frame-alist '(alpha 80 50))</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://www.emacswiki.org/emacs/FullScreen">全屏</a>,
不全屏怎么对得起emacs呢?</li>
</ul>


<h2>资源</h2>

<p>emacs自带的info文档已经很多了, 不过有一些其他地方的资源不错, 值得提一下:</p>

<ul>
<li><a href="http://www.emacswiki.org/">emacs wiki</a>,
我想emacs用户都应该知道这里吧.</li>
<li><a href="http://bitbucket.org/linjunhalida/emacs">我的配置</a>, 好吧, 分享下.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/ipython/">Ipython</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-30T13:03:47+08:00" pubdate data-updated="true">Nov 30<span>th</span>, 2010</time>
        
         | <a href="/blog/ipython/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>什么是ipython</h2>

<p>python里面的一个杀手级应用就是它的解释器,
我们可以利用这个解释器来完成一些日常的工作, 比如计算器, 字符串处理,
其他计算显示什么的. 但是python本身自带的解释器功能不够强大, 所以有了
<a href="http://ipython.scipy.org/moin/">ipython</a> 这个大杀器.
上面的图片显示的就是ipython的具体效果.</p>

<p>ipython的目标是成为一个全方位的交互性和探索计算的平台,
它好像是隶属于scipy下面的, 莫非有替代matlab的期望? 对于我们普通人来说,
它的特性已经足够好到替换掉python自带的那个解释器了. 下面为大家介绍.</p>

<h2>如何安装</h2>

<p>先把ipython装起来吧. ubuntu下面: .. code-block:: sh</p>

<blockquote><p>sudo apt-get install ipython</p></blockquote>

<p>其他系统可以看
<a href="http://ipython.scipy.org/doc/stable/html/install/install.html#installing-ipython-itself">安装文档</a></p>

<h2>ipython好在哪里?</h2>

<p>列出一些我觉得好用的东西:</p>

<ul>
<li><p>自动补全:</p>

<p>按下tab键会自动补全当前输入的对象名称.比如:</p></li>
</ul>


<!-- -->


<pre><code>In [1]: os.&lt;tab&gt; # 会自动列出os下面的所有东西
In [2]: abcd = 12
In [3]: abc&lt;tab&gt; # 自动补全成abcd
</code></pre>

<ul>
<li><p>缓存输入输出:</p>

<p>提示符是In [n]: 的格式, 也就是说, 你可以访问In和Out这2个list,
获取输入和输出.</p></li>
<li><p>整合命令行工具:</p>

<p>可以用!ls的方式来执行命令行工具, 甚至可以把结果当作参数来使用:</p></li>
</ul>


<!-- -->


<pre><code>In [4]: out = !ls
In [5]: for file in out: print file

bin
temp
</code></pre>

<ul>
<li>省略括号</li>
</ul>


<!-- -->


<pre><code>In [6]: s = "hello"
In [7]: s.replace 'he', 'yi'

'yillo'
</code></pre>

<ul>
<li><p>交互式GUI操作</p>

<p>ipython内嵌GUI处理机制,
使用tk/wxpython/pyqt可以交互式地创建和修改类.
创建出的对象是可以响应用户输入的, 并且能够实时修改.</p></li>
</ul>


<!-- -->


<pre><code>In [8]: from PyQt4.QtGui import *
In [9]: dlg = QDialog(); dlg.show()
In [10]: le = QLineEdit(); lw = QListWidget(); 
In [11]: l = QVBoxLayout(dlg); l.addWidget(le); l.addWidget(lw)
</code></pre>

<ul>
<li><p>帮助系统</p>

<p>对于任何对象s, 都可以用s??, s?的方式来看它的帮助文档.</p></li>
<li><p>run</p>

<p>可以用</p></li>
</ul>


<!-- -->


<pre><code>In[12]: run xxx.py
</code></pre>

<blockquote><p>来执行代码.</p></blockquote>

<ul>
<li><p>sh模式</p>

<p>ipython可以当作shell来使用. 只要执行:</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ipython -p sh
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>具体说明见:
<a href="http://ipython.scipy.org/doc/stable/html/interactive/shell.html">http://ipython.scipy.org/doc/stable/html/interactive/shell.html</a></p></blockquote>

<p>还有其他的很多很多很多特性, 我不一一列出来了.. 具体可以看
<a href="http://ipython.scipy.org/doc/stable/html/overview.html#id1">overview</a>,
以及进入ipython后, 运行:</p>

<pre><code>%quickref
</code></pre>

<p>来获取介绍信息.</p>

<h2>emacs + ipython</h2>

<p>作为emacs控, 所有东西都要整合到emacs里面去. 根据 <a href="http://www.emacswiki.org/emacs/PythonProgrammingInEmacs#toc10">emacs
python文档</a>
, 我只设置了这几行代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">(</span>require <span class="s1">&#39;ipython)</span>
</span><span class='line'><span class="s1">(global-set-key (kbd &quot;C-; 4&quot;) &#39;</span>py-shell<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>不过, 我还装了几个其他东西(ubuntu下面):</p>

<ul>
<li>ipython</li>
<li>python-mode</li>
<li>emacs23</li>
</ul>


<p>安装ipython后, 会自动给你一个配置文件:</p>

<pre><code>/usr/share/emacs/site-lisp/ipython.el 
</code></pre>

<p>所以只要require它就可以了.</p>

<h2>相关资源</h2>

<ul>
<li>`ipython`_ 官方网站</li>
<li><a href="http://ipython.scipy.org/doc/stable/html/">文档</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/pyqt-animation-framework/">Pyqt_animation_framework</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-30T09:14:01+08:00" pubdate data-updated="true">Nov 30<span>th</span>, 2010</time>
        
         | <a href="/blog/pyqt-animation-framework/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Qt animation framework介绍</h2>

<p>传统的GUI界面, 一般是静态的, 按钮就是按钮, 不会到处乱蹦,
不过现在这个时代, 冷冰冰的界面不是很吸引人. Qt 4.6里面带有新的animation
framework, 就可以帮助我们完成让界面&#8221;动起来&#8221;的工作.</p>

<h2>系统架构</h2>

<p><img src="http://doc.qt.nokia.com/4.7/images/animations-architecture.png" alt="image" />
上面是Qt支持动画的所有类的继承关系列表, 最主要的有几个:</p>

<ul>
<li><p><a href="http://doc.qt.nokia.com/4.7/qpropertyanimation.html">QPropertyAnimation</a>
类负责具体的动画效果,
它可以通过设置QWidget属性(property)的方式来完成动画.</p></li>
<li><p><a href="http://doc.qt.nokia.com/4.7/qanimationgroup.html">QAnimationGroup</a>,
用来把不同的动画拼在一起, 实现连续和复杂的动画效果.</p></li>
</ul>


<p>具体我们看实际的代码吧.</p>

<h2>示例1: 一个简单的动画</h2>

<p>正如上面所说的, `QPropertyAnimation`_ 负责动画, 这里一个简单的示例,
控制一个按钮移动. 代码如下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># 动来动去的按钮</span>
</span><span class='line'><span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s">&quot;Button&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">button</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 生成一个动画, 它会修改button的geometry属性</span>
</span><span class='line'><span class="n">animation</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;geometry&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c"># 动画时间是10秒</span>
</span><span class='line'><span class="n">animation</span><span class="o">.</span><span class="n">setDuration</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</span><span class='line'><span class="c"># 开始的位置</span>
</span><span class='line'><span class="n">animation</span><span class="o">.</span><span class="n">setStartValue</span><span class="p">(</span><span class="n">QRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
</span><span class='line'><span class="c"># 结束的位置</span>
</span><span class='line'><span class="n">animation</span><span class="o">.</span><span class="n">setEndValue</span><span class="p">(</span><span class="n">QRect</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
</span><span class='line'><span class="c"># 开始吧</span>
</span><span class='line'><span class="n">animation</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>很简单吧? 它默认是以恒定速度运动的, 可以通过设置
<a href="http://doc.qt.nokia.com/4.7/qvariantanimation.html#easingCurve-prop">easyCurve</a>
来设置运动的类型, 比如先加速后减速什么的, 很方便.</p>

<h2>示例2: 分组</h2>

<p>上面只是一个普通的动作, 如果我们需要做一组复杂的动作的话, 就要用
`QAnimationGroup`_ 来组织. 有2种group,
QParallelAnimationGroup和QtSequentialAnimationGroup, 一个平行动作,
一个顺序动作. 这个示例设置无数个按钮淡入到窗口中. 上代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#生成一堆按钮, 不同的初始位置</span>
</span><span class='line'><span class="bp">self</span><span class="o">.</span><span class="n">pbs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
</span><span class='line'>    <span class="n">pb</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>
</span><span class='line'>    <span class="n">pb</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">%</span> <span class="mi">600</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="mi">40</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">pbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 建立一个平行执行的动作组</span>
</span><span class='line'><span class="n">ag</span> <span class="o">=</span> <span class="n">QParallelAnimationGroup</span><span class="p">()</span>
</span><span class='line'><span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbs</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># 对于每个按钮, 都生成一个进入的动作</span>
</span><span class='line'>    <span class="n">a</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">&quot;geometry&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">a</span><span class="o">.</span><span class="n">setDuration</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span><span class='line'>    <span class="n">a</span><span class="o">.</span><span class="n">setEasingCurve</span><span class="p">(</span><span class="n">QEasingCurve</span><span class="o">.</span><span class="n">OutQuad</span><span class="p">)</span>
</span><span class='line'>    <span class="n">a</span><span class="o">.</span><span class="n">setStartValue</span><span class="p">(</span><span class="n">QRect</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">w</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">w</span><span class="o">.</span><span class="n">height</span><span class="p">()))</span>
</span><span class='line'>    <span class="n">a</span><span class="o">.</span><span class="n">setEndValue</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span>
</span><span class='line'>    <span class="c"># 添加到组里面去</span>
</span><span class='line'>    <span class="n">ag</span><span class="o">.</span><span class="n">addAnimation</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">ag</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>其实简单点说, 只要把要动作的animation添加到group里面, 然后start就好了.</p>

<h2>示例3: 状态机</h2>

<p>Qt本身提供一个状态机的功能, 和animation结合起来,
可以很方便地完成我们想要的工作. 毕竟, 不同状态的切换,
才是界面运动的本质. 这个示例演示一个按钮, 点击后会在两个位置之间移动.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">dlg</span> <span class="o">=</span> <span class="n">QDialog</span><span class="p">()</span>
</span><span class='line'><span class="n">dlg</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</span><span class='line'><span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s">&quot;Button&quot;</span><span class="p">,</span> <span class="n">dlg</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 我们先生成一个状态机</span>
</span><span class='line'><span class="n">machine</span> <span class="o">=</span> <span class="n">QStateMachine</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 然后给状态机加上几个状态:</span>
</span><span class='line'><span class="c"># 不同状态下, button的位置是不同的.</span>
</span><span class='line'><span class="n">state1</span> <span class="o">=</span>  <span class="n">QState</span><span class="p">(</span><span class="n">machine</span><span class="p">)</span>
</span><span class='line'><span class="n">state1</span><span class="o">.</span><span class="n">assignProperty</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">QRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
</span><span class='line'><span class="n">state2</span> <span class="o">=</span>  <span class="n">QState</span><span class="p">(</span><span class="n">machine</span><span class="p">)</span>
</span><span class='line'><span class="n">state2</span><span class="o">.</span><span class="n">assignProperty</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">QRect</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
</span><span class='line'><span class="n">machine</span><span class="o">.</span><span class="n">setInitialState</span><span class="p">(</span><span class="n">state1</span><span class="p">)</span> <span class="c"># 初始状态是哪个</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 然后, 我们需要设置状态变化的转换方式.</span>
</span><span class='line'><span class="n">transition1</span> <span class="o">=</span> <span class="n">state1</span><span class="o">.</span><span class="n">addTransition</span><span class="p">(</span><span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="n">state2</span><span class="p">)</span>
</span><span class='line'><span class="n">transition2</span> <span class="o">=</span> <span class="n">state2</span><span class="o">.</span><span class="n">addTransition</span><span class="p">(</span><span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="p">,</span> <span class="n">state1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># 把动作加到转换方式里面去</span>
</span><span class='line'><span class="n">an</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;geometry&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">transition1</span><span class="o">.</span><span class="n">addAnimation</span><span class="p">(</span><span class="n">an</span><span class="p">)</span>
</span><span class='line'><span class="n">an2</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="s">&quot;geometry&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">transition2</span><span class="o">.</span><span class="n">addAnimation</span><span class="p">(</span><span class="n">an2</span><span class="p">)</span>
</span><span class='line'><span class="c"># 设置完了, 开始吧.</span>
</span><span class='line'><span class="n">machine</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'><span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>就是这么简单..</p>

<h2>资源</h2>

<p>如果你安装了Qt4.6以上版本, 可以在assistant-qt4里面搜索the animation
framework看具体的文档, 也可以看 `在线版本
&lt;<a href="http://doc.qt.nokia.com/4.7/animation-overview.html">http://doc.qt.nokia.com/4.7/animation-overview.html</a>>`.
上面的例子都是脱胎于这个文档的.</p>

<p>Qt附带有几个好玩的示例, 在qt example下面的animation目录下面.
pyqt也是一样.</p>

<p>上面我写的的几个示例代码, 可以在这里下载到:
<a href="http://bitbucket.org/linjunhalida/code-example/src/tip/animation">http://bitbucket.org/linjunhalida/code-example/src/tip/animation</a>/</p>

<h2>结论</h2>

<p>Qt animation framework已经出来那么久了, 我现在才真正去学习它,
是有点晚了, 后面的QML都出来的时候, 现在再来看是否有点不合时宜?
但是看着Qt演变的过程, 还是有意义的. 有时间的话, 我去看看它实现的原理,
能不能从中借鉴点什么.</p>

<p>PS: pythonxy里面的pyqt还是4.5, 没有带有animation framework, 郁闷.
不好把功能加到公司项目里面去了.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/qwt-intro/">Qwt介绍与使用</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-27T10:55:37+08:00" pubdate data-updated="true">Nov 27<span>th</span>, 2010</time>
        
         | <a href="/blog/qwt-intro/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>什么是Qwt?</h2>

<p><img src="http://qwt.sourceforge.net/plot.png" alt="image" />
<a href="http://qwt.sourceforge.net/">Qwt</a> 是一个Qt的第三方库,
它的作用是为了方便一些科学技术相关领域GUI程序的开发.
它提供了一些好的控件: 2D谱图的绘制,
示波器等仪器上面有的控件:比如旋钮什么的.</p>

<p>我使用它, 是因为我要画曲线图, 频谱图等一系列科学领域需要展示的东西.
其实, 任何数据图, 都可以采用Qwt来绘制.
个人觉得它Qt里面最好用的画谱图工具. 对了, 它的性能很好,
可以做实时显示数据.</p>

<p>Qwt官方网站上面没有一步步的教程, 但是API的文档很全,
并且代码库中带有有很多例子可以参考. 因为我现在是采用pyqt做开发,
所以我使用 <a href="http://pyqwt.sourceforge.net/">pyqwt</a> 这个python下面的绑定.
上面也有很多示例. 虽然是python的代码, 我想,
C++程序员照样能够看懂(应该说所有的程序员都应该可以看懂..)</p>

<h2>Qwt架构</h2>

<p>Qwt的架构很简单, 官方文档上面虽然没有说, 但是我整理了一下:</p>

<pre><code>QwtPlot
   |
   |------- QwtPlotCurve
   |
   |------- QwtPlotCurve
</code></pre>

<p>QwtPlot就是谱图显示的控件, 任何需要显示的曲线(包括网格什么的),
都是QwtPlotCurve, 一个QwtPlot上面可以放很多的QwtPlotCurve.</p>

<p>具体职责:</p>

<ul>
<li><a href="http://qwt.sourceforge.net/class_qwt_plot.html">QwtPlot</a>
负责坐标的部分, 比如显示的范围, X轴Y轴什么的. 要注意的是,
它可以有多个X和多个Y, 方便不同Y值的谱图叠在一起.</li>
<li>QwtPlotCurve负责如何去绘制谱图, 比如画直方图, 网格什么的.
它还有一个子类:
<a href="http://qwt.sourceforge.net/class_qwt_plot_marker.html">QwtPlotMarker</a>,
可以对谱图的特定位置做标记.</li>
</ul>


<h2>上代码</h2>

<p>下面是我的一个实例代码, 内容就是负责画一个直方图, 效果如下:</p>

<p><img src="http://bitbucket.org/linjunhalida/code-example/raw/tip/qwt/barplot.png" alt="image" />
代码在
<a href="http://bitbucket.org/linjunhalida/code-example/src/tip/qwt/main.py">这里</a>
.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/qml/">Qml介绍</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-24T21:35:12+08:00" pubdate data-updated="true">Nov 24<span>th</span>, 2010</time>
        
         | <a href="/blog/qml/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>QML</h2>

<p>今天去看Qt的最新进展, 发现: Qt 4.7 已于2010年九月份发布了,
里面带有一个全新的写GUI的方式: QML.</p>

<p>具体相关的介绍, 在
<a href="http://doc.qt.nokia.com/4.7-snapshot/index.html">Qt4.7官方文档</a> 上面有
<a href="http://doc.qt.nokia.com/4.7-snapshot/qdeclarativeintroduction.html">QML介绍</a>
. 我花了半个晚上的时间来学习
<a href="http://doc.qt.nokia.com/4.7-snapshot/qml-tutorial.html">QML的教程</a> ,
发现真的不错.</p>

<p>下面是 `QML的教程`_ 里面的内容, 我稍微介绍一下.</p>

<h2>示例1</h2>

<p>简单点说, QML就是以定义的方式来写界面, 格式很像CSS. 一个简单的示例代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//首先引入相关的模块</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">1.0</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Rectangle</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">id</span><span class="o">:</span> <span class="nx">page</span>
</span><span class='line'>    <span class="nx">width</span><span class="o">:</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">200</span>
</span><span class='line'>    <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;lightgray&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">Text</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">id</span><span class="o">:</span> <span class="nx">helloText</span>
</span><span class='line'>        <span class="nx">text</span><span class="o">:</span> <span class="s2">&quot;Hello world!&quot;</span>
</span><span class='line'>        <span class="nx">y</span><span class="o">:</span> <span class="mi">30</span>
</span><span class='line'>        <span class="nx">anchors</span><span class="p">.</span><span class="nx">horizontalCenter</span><span class="o">:</span> <span class="nx">page</span><span class="p">.</span><span class="nx">horizontalCenter</span>
</span><span class='line'>        <span class="nx">font</span><span class="p">.</span><span class="nx">pointSize</span><span class="o">:</span> <span class="mi">24</span><span class="p">;</span> <span class="nx">font</span><span class="p">.</span><span class="nx">bold</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里面定义了一个Rectangle(其实就是方块啦)作为背景, 上面再加了一个Text.
注意, Text的位置是通过设定anchors的方法来定位的.</p>

<p>显示的效果就是:</p>

<p><img src="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial1.png" alt="image" /></p>

<h2>示例2</h2>

<p>QML能够自己定义对象类型, 比如,新建一个文件Cell.qml:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">1.0</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Item</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">id</span><span class="o">:</span> <span class="nx">container</span>
</span><span class='line'>    <span class="nx">property</span> <span class="nx">alias</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="nx">rectangle</span><span class="p">.</span><span class="nx">color</span>
</span><span class='line'>    <span class="nx">signal</span> <span class="nx">clicked</span><span class="p">(</span><span class="nx">color</span> <span class="nx">cellColor</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">width</span><span class="o">:</span> <span class="mi">40</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">25</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">Rectangle</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">id</span><span class="o">:</span> <span class="nx">rectangle</span>
</span><span class='line'>        <span class="nx">border</span><span class="p">.</span><span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;white&quot;</span>
</span><span class='line'>        <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">MouseArea</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span>
</span><span class='line'>        <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clicked</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">cellColor</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里面定义了一个Cell类型, 它里面有一个Rectangle,
以及一个MouseArea(后面再说).</p>

<p>我们可以定义新的属性:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">property</span> <span class="nx">alias</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="nx">rectangle</span><span class="p">.</span><span class="nx">color</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个属性只是Rectangle颜色的别名.</p>

<p>也可以定义新的事件:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">signal</span> <span class="nx">clicked</span><span class="p">(</span><span class="nx">color</span> <span class="nx">cellColor</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>MouseArea是用来做用户交互的,
我们把它的onClicked事件和我们定义的clicked事件绑定起来:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">MouseArea</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clicked</span><span class="p">(</span><span class="nx">container</span><span class="p">.</span><span class="nx">cellColor</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样, 当用户点击Cell之后, 就会触发clicked事件,
这个事件附带Cell方块的颜色作为参数.</p>

<p>我们定义了一个Cell之后, 如何使用呢? 这里是使用Cell的代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">QtQuick</span> <span class="mf">1.0</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Rectangle</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">id</span><span class="o">:</span> <span class="nx">page</span>
</span><span class='line'>    <span class="nx">width</span><span class="o">:</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">200</span>
</span><span class='line'>    <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;lightgray&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">Text</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">id</span><span class="o">:</span> <span class="nx">helloText</span>
</span><span class='line'>        <span class="nx">text</span><span class="o">:</span> <span class="s2">&quot;Hello world!&quot;</span>
</span><span class='line'>        <span class="nx">y</span><span class="o">:</span> <span class="mi">30</span>
</span><span class='line'>        <span class="nx">anchors</span><span class="p">.</span><span class="nx">horizontalCenter</span><span class="o">:</span> <span class="nx">page</span><span class="p">.</span><span class="nx">horizontalCenter</span>
</span><span class='line'>        <span class="nx">font</span><span class="p">.</span><span class="nx">pointSize</span><span class="o">:</span> <span class="mi">24</span><span class="p">;</span> <span class="nx">font</span><span class="p">.</span><span class="nx">bold</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">Grid</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">id</span><span class="o">:</span> <span class="nx">colorPicker</span>
</span><span class='line'>        <span class="nx">x</span><span class="o">:</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">anchors</span><span class="p">.</span><span class="nx">bottom</span><span class="o">:</span> <span class="nx">page</span><span class="p">.</span><span class="nx">bottom</span><span class="p">;</span> <span class="nx">anchors</span><span class="p">.</span><span class="nx">bottomMargin</span><span class="o">:</span> <span class="mi">4</span>
</span><span class='line'>        <span class="nx">rows</span><span class="o">:</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">columns</span><span class="o">:</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">spacing</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
</span><span class='line'>        <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
</span><span class='line'>        <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
</span><span class='line'>        <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;yellow&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
</span><span class='line'>        <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;steelblue&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
</span><span class='line'>        <span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;black&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>效果如下:</p>

<p><img src="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial2.png" alt="image" />
别看上面那些代码那么多, 其实都是些图块的定义. 功能就是,
点击上面一堆Cell其中的一个, 就会改变Hello world的颜色. 如何做到的呢?
只要定义Cell的onClicked事件引发后, 对应执行的代码就好了:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Cell</span> <span class="p">{</span> <span class="nx">cellColor</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">;</span> <span class="nx">onClicked</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">cellColor</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>示例3</h2>

<p>QML最神奇的地方是, 能够定义效果, 比如实现这个:</p>

<p><img src="http://doc.qt.nokia.com/4.7-snapshot/images/declarative-tutorial3_animation.gif" alt="image" />
当鼠标点击hello world的时候, 就会出现上面的动画.</p>

<p>核心代码是这个:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Text</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">text</span><span class="o">:</span> <span class="s2">&quot;Hello world!&quot;</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">MouseArea</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">mouseArea</span><span class="p">;</span> <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">states</span><span class="o">:</span> <span class="nx">State</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">;</span> <span class="nx">when</span><span class="o">:</span> <span class="nx">mouseArea</span><span class="p">.</span><span class="nx">pressed</span> <span class="o">==</span> <span class="kc">true</span>
</span><span class='line'>        <span class="nx">PropertyChanges</span> <span class="p">{</span> <span class="nx">target</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">;</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">160</span><span class="p">;</span> <span class="nx">rotation</span><span class="o">:</span> <span class="mi">180</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">transitions</span><span class="o">:</span> <span class="nx">Transition</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">;</span> <span class="nx">reversible</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>        <span class="nx">ParallelAnimation</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">NumberAnimation</span> <span class="p">{</span> <span class="nx">properties</span><span class="o">:</span> <span class="s2">&quot;y,rotation&quot;</span><span class="p">;</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Easing</span><span class="p">.</span><span class="nx">InOutQuad</span> <span class="p">}</span>
</span><span class='line'>            <span class="nx">ColorAnimation</span> <span class="p">{</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>先定义一个MouseArea, 捕捉用户点击的事件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">MouseArea</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">mouseArea</span><span class="p">;</span> <span class="nx">anchors</span><span class="p">.</span><span class="nx">fill</span><span class="o">:</span> <span class="nx">parent</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后定义一个Hello world翻转的状态, 当mouseArea被点击的时候,
就会把自己变成翻转的状态.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">states</span><span class="o">:</span> <span class="nx">State</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">;</span> <span class="nx">when</span><span class="o">:</span> <span class="nx">mouseArea</span><span class="p">.</span><span class="nx">pressed</span> <span class="o">==</span> <span class="kc">true</span>
</span><span class='line'>    <span class="nx">PropertyChanges</span> <span class="p">{</span> <span class="nx">target</span><span class="o">:</span> <span class="nx">helloText</span><span class="p">;</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">160</span><span class="p">;</span> <span class="nx">rotation</span><span class="o">:</span> <span class="mi">180</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="s2">&quot;red&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>当然, 现在的话点击之后, 就会立刻把hello world翻转过来,
我们要定义一个效果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">transitions</span><span class="o">:</span> <span class="nx">Transition</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 这个效果是为从初始状态变为down状态而设定的</span>
</span><span class='line'>    <span class="nx">from</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="nx">to</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 并且这个效果是双向的, down变回初始状态也会反过来执行这样的效果.</span>
</span><span class='line'>    <span class="nx">reversible</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 好了, 这里具体定义效果是什么. ParallelAnimation是说同时进行若干效果</span>
</span><span class='line'>    <span class="nx">ParallelAnimation</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 转换方向</span>
</span><span class='line'>        <span class="nx">NumberAnimation</span> <span class="p">{</span> <span class="nx">properties</span><span class="o">:</span> <span class="s2">&quot;y,rotation&quot;</span><span class="p">;</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">easing</span><span class="p">.</span><span class="nx">type</span><span class="o">:</span> <span class="nx">Easing</span><span class="p">.</span><span class="nx">InOutQuad</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 变色</span>
</span><span class='line'>        <span class="nx">ColorAnimation</span> <span class="p">{</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>通过这样定义的方式来写GUI, 是不是很清晰明了?</p>

<h2>结论</h2>

<p>我原先接触过WPF, 也是定义的方式来做的, 现在看到Qt也支持了, 感到蛮欣慰的.
我现在使用pyqt, 听说pyside的snapshot里面已经支持qml了,
期待稳定版本的发布.</p>

<p>看到网站上面有对应的截图, 个人猜测他们会把QML的内容整合到web上面.
QML是支持javascript的, 具体内容可在
<a href="http://doc.qt.nokia.com/4.7-snapshot/qml-advtutorial.html">深入教程</a>
里面, 可以看看.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/why-qt-is-for-you/">为什么qt是最适合你的</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-22T21:02:51+08:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2010</time>
        
         | <a href="/blog/why-qt-is-for-you/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://hopf.chem.brandeis.edu/yanglingfa/pic/Qt_logostrap_CMYK.png" alt="image" /></p>

<p>很多python开发人员, 在选择界面库的时候都会犹豫一段时间, 到底是选择tk,
wxpython, pygtk, pyqt, 还是什么其他奇怪的解决方案. 这里, 我建议,
不要多想了, 节省你的时间和精力, 选择pyqt.</p>

<p>很多开发人员, 在选择界面库时候(至少是你能够选择的时候)都会犹豫很长时间,
到底是MFC, winform, WPF, flash, swing, VCL(还有人知道delphi吗),
还是什么其他奇怪的解决方案, 这里, 我建议, 不要多想了,
节省你的时间和精力, 选择pyqt.</p>

<p>好了, 广告时间结束, 这里说明理由:</p>

<ul>
<li><p>为什么python?</p>

<ul>
<li>python是最好用最好学的编程语言(没有之一, VB不够好用)</li>
<li>根据GUI的本质思维, 只有动态语言才能做到那么强的灵活性.
所以C/C++/java什么的不方便开发. 不然你动态生成页面试试?</li>
<li>快速开发. 同样的功能, python的代码是其他语言的若干分之一.
代码量少了, 开发速度和质量都提高了.</li>
</ul>
</li>
<li><p>为什么Qt?</p>

<ul>
<li>工业级别的界面库. tk, wxpython都太简陋了, 不堪大用.
wxpython还有性能问题. (by Jimmy Kuu)</li>
<li>跨平台. VCL, winform, WPF, GTK可能好用一些, 但是跨平台试试?
以后一辈子和某个平台挂钩了. (好吧, GTK, mono可能多平台..
但是没有pyqt好用)</li>
<li>简单直观的事件处理方式.
只需要把一个signal插入到一个slot里面就好了, 并且是热拔插.
callback机制已经过时了.</li>
<li>性能很好, 足够工程使用. 一个实际的例子:
linux下面的桌面系统KDE是基於Qt的.</li>
</ul>
</li>
<li><p>虽然pyqt很好, 但是还有其他需要注意的方面</p>

<ul>
<li>如果你是开源项目, 随便用. 但是如果是商业闭源, 那需要给
<a href="http://www.riverbankcomputing.co.uk/news">riverbank</a> 他们交费,
一个开发者350英镑, 还是蛮划算的(比起开发时间来说).
或者你可以考虑 <a href="http://www.pyside.org">pyside</a>?</li>
<li>发布. 打包后的pyqt程序, 10M左右, 如果你对空间要求很严格的话,
就不适合了. 但是现在这个网络时代, 这应该不成问题. QQ都非常大了..</li>
<li>性能. 如果你要画实时图片, 3d什么的, python恐怕太慢了,
老实用回C++吧.</li>
<li>移动应用. <a href="http://meego.com/">meego</a> 还早,
好像可以在android上面写python, 但是pyqt.. 哈哈哈.</li>
<li>web2.0. 好吧, jquery是你的武器. 写javascript去吧. 还有flash..</li>
</ul>
</li>
</ul>


<p>还有我一些其他的看法:</p>

<ul>
<li>Qt的designer是杀手级的. 在linux下面. glader什么的都去死吧.</li>
<li>tk8.5好像解决了中文问题. 但是控件是不是太少了? 不够用阿.</li>
<li>wxpython太丑了. 哪里比得上Qt支持的qss方式动态设置风格.</li>
<li>pyGTK? 没用过. 有时间看看.</li>
<li>MFC sucks.</li>
<li>delphi. 编译飞快. 但是动态生成界面? 当年研究了很久..</li>
<li>WPF: WTF..</li>
<li>winform. 他们说不好, 我觉得还好吧?</li>
<li>android/iOS. 好吧, 我落伍了.</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/11/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/9/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/gdc-china-2012/">GDC China 2012</a>
      </li>
    
      <li class="post">
        <a href="/blog/new-mac-book-pro/">买了新的笔记本</a>
      </li>
    
      <li class="post">
        <a href="/blog/postfix/">postfix架构初探</a>
      </li>
    
      <li class="post">
        <a href="/blog/standing-at-work/">尝试站着工作</a>
      </li>
    
      <li class="post">
        <a href="/blog/kazakhstan-time-zone/">尝试哈萨克斯坦时间</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/halida">@halida</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'halida',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("linjunhalida", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/linjunhalida" class="twitter-follow-button" data-show-count="false">Follow @linjunhalida</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/linjunhalida?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - 机械唯物主义 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'halidasvps';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
