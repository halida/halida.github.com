
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>网络寻租</title>
  <meta name="author" content="机械唯物主义">

  
  <meta name="description" content="qt的多国语言支持方案 qt在设计的时候就考虑到了多国语言应该如何处理, 原理以及使用方法很简单.
如下: 第一步: 写代码的时候, 对于需要翻译的词语, 用tr()包起来, 比如: QPushButton hello(QPushButton::tr("Hello world!")); &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.linjunhalida.com/blog/page/28/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="网络寻租" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<!-- <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26509244-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">网络寻租</a></h1>
  
    <h2>Programmer, Gamer, Hacker</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.linjunhalida.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">博客</a></li>
  <li><a href="/blog/categories/english">English Blog</a></li>
  <li><a href="/about">关于我</a></li>
  <li><a href="/blog/archives">存档</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/pyqt-i18n/">Pyqt多国语言</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-21T16:44:39+08:00" pubdate data-updated="true">Nov 21<span>st</span>, 2010</time>
        
         | <a href="/blog/pyqt-i18n/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>qt的多国语言支持方案</h2>

<p>qt在设计的时候就考虑到了多国语言应该如何处理, 原理以及使用方法很简单.
如下:</p>

<p>第一步: 写代码的时候, 对于需要翻译的词语, 用tr()包起来, 比如:</p>

<pre><code>QPushButton hello(QPushButton::tr("Hello world!"));
</code></pre>

<p>这样qt就知道这些词语是需要翻译的了. 然后qt需要把这些词语取出来,
放到一个文件里面去, 好进行下一步的翻译工作.</p>

<p>在你的pro文件里面说明这个文件的名称:</p>

<pre><code>TRANSLATIONS    = clabel_zh_CN.ts
</code></pre>

<p>这样就可以利用lupdate这个工具来把需要翻译的词语取出来:</p>

<pre><code>lupdate-qt4 clabel.pro
</code></pre>

<p>然后, 我们就可以开始翻译工作了. qt提供了一个配套的翻译工具: linguist:</p>

<pre><code>linguist-qt4 clabel_zh_CN.ts
</code></pre>

<p>其实ts文件是xml的格式, 你想直接编辑文本也是可以的.</p>

<p>当做完翻译工作之后, 我们需要把ts文件编译一下, 方便程序使用:</p>

<pre><code>lrelease-qt4 clabel_zh_CN.ts
</code></pre>

<p>这样就会生成clabel_zh_CN.qm. 最后, 在代码里面加上选择语言的代码:</p>

<pre><code>QTranslator trans;
trans.load("clabel_zh_CN");
app.installTranslator(&amp;trans);

QPushButton hello(QPushButton::tr("Hello world!"));
hello.show();

app.exec();
</code></pre>

<p>qt多国语言更详细的介绍在:
<a href="http://doc.qt.nokia.com/4.6/i18n-source-translation.html">http://doc.qt.nokia.com/4.6/i18n-source-translation.html</a></p>

<h2>pyqt下面如何实现多国语言</h2>

<p>pyqt里面实现的过程和qt里面的类似, 只是因为第一步需要扫描的不是c++代码,
所以需要利用一个pyqt的工具: pylupdate4, 用法和lupdate一样.</p>

<p>首先写程序</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="n">trans</span> <span class="o">=</span> <span class="n">QTranslator</span><span class="p">()</span>
</span><span class='line'><span class="n">trans</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;plabel_zh_CN&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">app</span><span class="o">.</span><span class="n">installTranslator</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;hello world!&quot;</span><span class="p">))</span>
</span><span class='line'><span class="n">button</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>等等, 里面的tr是什么?</p>

<pre><code>def tr(msg):
    return QCoreApplication.translate("@default", msg)
</code></pre>

<p>qt翻译是根据类的名称来走的, 调用了什么类的tr, 就取这个类里面设置的翻译.</p>

<p>qt里面是可以利用QObject::tr来翻译, 但是pyqt里面不能,
pylupdate4只是做字符串查找, 看有什么字符串是在tr后面的,
然后根据tr调用者来把这个词语归类, 如果没有调用者, 就把它归类到
&ldquo;@default&rdquo; 里面. 于是我就只好利用上面的方法来做一个规避..有点恶心,
看看以后是否会有更好的方法来处理.</p>

<p>对于类里面的翻译, 不需要那么麻烦:</p>

<pre><code>class Input(QWidget):
    def __init__(self):
        super(Input, self).__init__()
        label = QLabel(self.tr("input:"))
</code></pre>

<p>这里面的tr, 就可以被正确翻译出来.</p>

<p>然后运行pylupdate, 因为我们是python程序, 没有pro, 就只能手动指定文件了</p>

<pre><code>pylupdate4 main.py -ts plabel_zh_CN.ts
</code></pre>

<p>好了, 下面的步骤和c++的方法一样</p>

<pre><code>linguist-qt4 clabel_zh_CN.ts
lrelease-qt4 plabel_zh_CN.ts
</code></pre>

<p>然后执行代码, 程序按照我们期望的方式翻译过来了, 是不是很简单?</p>

<p>上面的示例代码放在这里:
<a href="http://bitbucket.org/linjunhalida/pyqt-i10n-example">http://bitbucket.org/linjunhalida/pyqt-i10n-example</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/minecraft/">Minecraft介绍</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-12T10:34:10+08:00" pubdate data-updated="true">Nov 12<span>th</span>, 2010</time>
        
         | <a href="/blog/minecraft/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>什么是minecraft?</h2>

<p>随机生成的世界, 完全自由建设, 合成系统, 晚上的怪物, 铁路</p>

<p>下雪了</p>

<p><img src="http://minecraftgallery.com/wp-content/uploads/2010/10/inceptionSnowFort-610x260.jpg" alt="image" /></p>

<p>未来世界</p>

<p><img src="http://minecraftgallery.com/wp-content/uploads/2010/10/FuturisticCityBiome-610x260.png" alt="image" /></p>

<p>6英里</p>

<p><embed src="http://player.youku.com/player.php/sid/XMjE0NzIzNTEy/v.swf" quality="high" width="480" height="400" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash"></embed></p>

<p>视频</p>

<ul>
<li><a href="http://www.google.com/search?q=minecraft+site:youtube.com">youtube视频</a></li>
<li><a href="http://www.google.com/search?q=minecraft+site:youku.com">优酷视频</a></li>
</ul>


<p>图片</p>

<ul>
<li><a href="http://minecraftgallery.com/">专门的图片站</a></li>
<li><a href="http://www.minecraftforum.net/viewtopic.php?f=1012&amp;t=22626">多人模式图片</a></li>
<li><a href="http://www.minecraftforum.net/viewtopic.php?f=35&amp;t=26376">很多用户在发自己造的房子</a></li>
</ul>


<h2>多说无益, 直接点开来玩吧</h2>

<ul>
<li><a href="http://minecraft.net/play.jsp">单人自由模式</a> 可以随意建造, 资源无限</li>
<li><a href="http://minecraft.net/servers.jsp">多人自由模式</a> 直接去到别人做的世界玩玩</li>
<li><a href="http://minecraft.net/game/">生存模式</a> 有血条, 生命值, 物品栏, 怪物, 合成系统, 主要的乐趣在这个模式下.</li>
</ul>


<p>97块人民币, 在线帐号, 至少3个月不腻, 值了!</p>

<h2>爽点在哪里?</h2>

<ul>
<li>一个随机生成的世界</li>
<li>你可以很简单地建造</li>
<li>资源需要自己去开采, 为了宝石, 需要挖到地底</li>
<li>合成建造一些奇奇怪怪的东西, 比如铁路, 玻璃, 逻辑电路, 过山车就不算什么了, 有人做了CPU出来..</li>
<li>多人模式, 可以合作建造, 可以玩RPG, 可以战争..</li>
<li>可以在浏览器内打开(java写的)</li>
</ul>


<h2>如何开始?</h2>

<p>可以看 <a href="http://minecraftwiki.net/">wiki</a> , 里面有详细的帮助.</p>

<h2>minecraft定制</h2>

<p>官方论坛有<a href="http://www.minecraftforum.net/viewforum.php?f=25">专门的区域</a>讨论这个.</p>

<p><a href="http://www.minecraftwiki.net/wiki/Tutorials/Saved_Data_Dropbox_Guide_Saves_Only">同步minecraft文件</a></p>

<p>为了好看, 我加了几个显示模组:</p>

<ul>
<li><a href="http://www.minecraftforum.net/viewtopic.php?f=25&amp;t=65936">AaGeOn&rsquo;s BumpMaft HD texture Pack</a></li>
<li><a href="http://www.minecraftforum.net/viewtopic.php?f=25&amp;t=64678">Aza&rsquo;s Arid texture pack</a></li>
<li>小地图 <a href="http://www.minecraftforum.net/viewtopic.php?f=25&amp;t=64678">mrmmods</a></li>
</ul>


<h2>minecraft修改</h2>

<p><a href="http://www.minecraftwiki.net/wiki/Programs_and_Editors">修改器目录</a></p>

<p>但我在ubuntu下面, 只有MCPlayerEdit最好用, 因为是python的.</p>

<h2>搭建minecraft服务器</h2>

<p><a href="http://www.minecraftwiki.net/wiki/Server">如何搭建官方服务器</a></p>

<p>第三方工具 <a href="http://minecraftwiki.net/wiki/McMyAdmin">McMyAdmin</a></p>

<h2>ubuntu下面注意!</h2>

<p>因为minecraft是用java写的, 会和ibus输入法冲突(找了半天才知道),
造成无法输入键盘命令, 玩之前需要:</p>

<pre><code>pkill ibus
</code></pre>

<h2>资源</h2>

<ul>
<li><a href="http://minecraft.net">官方网站</a></li>
<li><a href="http://www.minecraftforum.net/index.php">官方论坛</a></li>
<li><a href="http://minecraftwiki.net/">wiki</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/game-I-play/">我玩的游戏</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-10T16:20:12+08:00" pubdate data-updated="true">Nov 10<span>th</span>, 2010</time>
        
         | <a href="/blog/game-I-play/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>虽然有点无聊, 但是还是整理一下那些能让我通宵,
或者至少沉迷一段时间的游戏, 按照时间排列, 太早以前的就不去管它了.</p>

<h2>adom</h2>

<p>很早的时候迷roguelike, 但是无论是nethack/crawl都玩不进去,
可能是一层层的地牢让我心生恐惧吧.
最后我还是在有城镇的ADOM里面坚持了下去.
不过当步入火焰层烧掉了我大半载重之后, 就放弃了.</p>

<h2>cortex command</h2>

<p><a href="http://blog.linjunhalida.com/blog/cortex-command/">Cortex Command介绍</a></p>

<p>这款游戏让我通宵了. 完成度不高, 但是能够建设基地, 爽快的射击与杀戮,
以及物理系统带来的纷飞碎块, 真的让我沉迷了好一阵子.
现在还待在我的硬盘里面. 游戏性能和CPU成正比.</p>

<h2>drawf fortress</h2>

<p><a href="http://blog.linjunhalida.com/blog/DwarfFortress-intro/">Drawf fortress介绍</a></p>

<p>又是一款字符界面游戏, 又是建设基地, 多层, 自由活动的矮人,
随机生成的世界, 操作非常复杂, 以前接触过, 但是在操作面前退步了.
终于有机会玩会了, 但是因为要想很多东西, 我智能不够,
玩到一定程度就停止了.</p>

<h2>minecraft</h2>

<p><a href="http://blog.linjunhalida.com/blog/minecraft/">minecraft介绍</a></p>

<p>随机生成的世界, 完全自由建设, 合成系统, 晚上的怪物, 铁路,
作者赚了几百万欧元.</p>

<p>这款游戏让我通宵了.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/reStructuredText-intro/">reStructuredText介绍</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-10T15:39:39+08:00" pubdate data-updated="true">Nov 10<span>th</span>, 2010</time>
        
         | <a href="/blog/reStructuredText-intro/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>什么是reStructuredText?</h2>

<p>一种写文档的方式. 简称:
<a href="http://docutils.sourceforge.net/rst.html#try-it-online">ReST</a></p>

<ul>
<li>简单, 现场学,现场会</li>
<li>易读</li>
<li>方便生成html/pdf等其他格式</li>
</ul>


<h2>怎么玩?</h2>

<p>不多说, 直接用: <a href="http://goo.gl/1jNF4">http://goo.gl/1jNF4</a></p>

<h2>语法</h2>

<p>There should be one&mdash; and preferably only one &mdash;obvious way to do it.</p>

<p>google: rest</p>

<p><a href="http://docutils.sourceforge.net/docs/user/rst/quickstart.html">http://docutils.sourceforge.net/docs/user/rst/quickstart.html</a>
<a href="http://docutils.sourceforge.net/docs/user/rst/quickref.html">http://docutils.sourceforge.net/docs/user/rst/quickref.html</a></p>

<h2>如何生成其他格式</h2>

<p>需要安装docutils</p>

<ul>
<li><p>html: 有个东西叫rst2html:</p>

<pre><code>rst2html xxx.rst xxx.html
</code></pre></li>
<li><p>pdf: 有个东西叫rst2pdf:</p>

<pre><code>rst2pdf xxx.rst
</code></pre></li>
<li><p>latex: 有个东西叫rst2latex:</p>

<pre><code>rst2latex --input-encoding=utf-8 --output-encoding=utf-8 xxx.rst &gt;&gt; s.tex
</code></pre></li>
</ul>


<h2>python code</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="kn">from</span> <span class="nn">docutils.core</span> <span class="kn">import</span> <span class="n">publish_string</span>
</span><span class='line'><span class="n">content</span> <span class="o">=</span> <span class="n">publish_string</span><span class="p">(</span>
</span><span class='line'>    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;doc here&quot;</span>
</span><span class='line'>    <span class="n">writer_name</span><span class="o">=</span><span class="s1">&#39;html&#39;</span>
</span><span class='line'>    <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>我用它来干什么?</h2>

<ul>
<li>写博客</li>
<li>写文档</li>
<li>问题: 好像没有支持ReST的网站..</li>
</ul>


<h2>连接</h2>

<ul>
<li>官方网站:
<a href="http://docutils.sourceforge.net/rst.html#try-it-online">ReST</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/pyqt-intro/">Pyqt介绍</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-10T08:59:03+08:00" pubdate data-updated="true">Nov 10<span>th</span>, 2010</time>
        
         | <a href="/blog/pyqt-intro/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>最强大的GUI库 &mdash; PyQt4</h2>

<p>Authors
  ~ 机械唯物主义</p>

<pre><code>&lt;[linjunhalida@gmai.com](mailto:linjunhalida@gmai.com)\&gt;
</code></pre>

<h2>一个简单的实例</h2>

<ul>
<li>计算器</li>
<li>10分钟</li>
</ul>


<p><img src="http://lh6.ggpht.com/_os_zrveP8Ns/TNnrsk8C64I/AAAAAAAADMc/TMTjkv1is7k/s800/caculator_ui.png" alt="image" /></p>

<h2>代码</h2>

<p><img src="http://lh3.ggpht.com/_os_zrveP8Ns/TNnooDH5dtI/AAAAAAAADLo/KK7FwKekTRo/s800/caculator.JPG" alt="image" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="ch">#!/usr/bin/env python</span>
</span><span class='line'><span class="c1">#-*- coding:utf-8 -*-</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Caculator</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">Caculator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span class='line'>        <span class="c1">#widgets</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">leInput</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">lwResult</span> <span class="o">=</span> <span class="n">QListWidget</span><span class="p">()</span>
</span><span class='line'>        <span class="c1">#layouts</span>
</span><span class='line'>        <span class="n">l</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">leInput</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lwResult</span><span class="p">:</span>
</span><span class='line'>            <span class="n">l</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span><span class='line'>        <span class="c1">#events</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">leInput</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caculate</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">caculate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">data</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leInput</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span> <span class="k">return</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">leInput</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">result</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span class='line'>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>            <span class="n">result</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">lwResult</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span class='line'>    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">([])</span>
</span><span class='line'>    <span class="n">Caculator</span><span class="p">()</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>类层级</h2>

<pre><code>QObject
   |----- QWidget
             |----- QDialog
             |----- QLineEdit
             |----- QListWidget
</code></pre>

<h2>layout</h2>

<p><img src="http://lh3.ggpht.com/_os_zrveP8Ns/TNnoon5j6aI/AAAAAAAADLw/ITJ9fVU9YtE/s800/layout.JPG" alt="image" /></p>

<h2>layout</h2>

<ul>
<li><p>层级:</p>

<pre><code>QDialog (QVBoxLayout)
   |----- QLineEdit
   |----- QListWidget
</code></pre></li>
<li><p>代码:</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="n">l</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">leInput</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lwResult</span><span class="p">:</span>
</span><span class='line'>    <span class="n">l</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Signal and Slot in Qt</h2>

<p><img src="http://lh4.ggpht.com/_os_zrveP8Ns/TNnoo68TzKI/AAAAAAAADL4/jPjbRhwQEI8/s800/signal_and_slot.JPG" alt="image" /></p>

<h2>Qt和PyQt 事件机制区别</h2>

<ul>
<li>Qt:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span></span><span class="k">this</span><span class="o">-&gt;</span><span class="n">connect</span><span class="p">(</span><span class="n">leInput</span><span class="p">,</span> <span class="n">SINGAL</span><span class="p">(</span><span class="n">returnPressed</span><span class="p">()),</span> <span class="k">this</span><span class="p">,</span> <span class="n">caculate</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>PyQt:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="bp">self</span><span class="o">.</span><span class="n">leInput</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caculate</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>一个复杂的实例: 扫雷</h2>

<ul>
<li>花费时间: 2个晚上, 基础:2.5小时, 一点点提升:1小时</li>
<li>扫雷下载: <a href="https://bitbucket.org/linjunhalida/pyqtmine/">pyqtmine</a></li>
</ul>


<p><img src="http://lh6.ggpht.com/_os_zrveP8Ns/TNnoooQuryI/AAAAAAAADL0/MLwyt5qromk/s800/pyqtmine.JPG" alt="image" /></p>

<h2>UI designer</h2>

<p><img src="http://lh4.ggpht.com/_os_zrveP8Ns/TNnoodk5clI/AAAAAAAADLs/cbHdyQCMco8/s800/designer.JPG" alt="image" /></p>

<h2>UI with Code</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="n">form</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span><span class="s2">&quot;score.ui&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ScoreDlg</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">ScoreDlg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Event</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
</span><span class='line'>        <span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">paintEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>    <span class="n">p</span> <span class="o">=</span> <span class="n">QPainter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="n">p</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">mx</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">sx</span><span class="p">,</span> <span class="n">my</span><span class="p">,</span> <span class="n">mx</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">sx</span><span class="p">,</span> <span class="n">my</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">sy</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>其他强大特性</h2>

<ul>
<li>足够多和好用的控件/自定控件/整合到designer中</li>
<li>webkit/script支持</li>
<li>强大/方便/快速的绘图控件</li>
<li>富文本/文本解析</li>
<li>多国语言支持</li>
<li>其他第三方控件支持: pyqwt</li>
</ul>


<h2>发布</h2>

<p><a href="http://www.pyinstaller.org/">pyinstaller</a>!</p>

<h2>资源</h2>

<ul>
<li><p>PyQt安装
  ~ &ndash;   ubuntu:</p>

<pre><code>        sudo apt-get install pyqt4-dev-tools

-   windows可以下载一个python包:
    [pythonxy](http://www.pythonxy.com)
</code></pre></li>
<li><p>学习材料
  ~ &ndash;   <a href="http://qt.nokia.com/products/">qt</a> 以及
        <a href="http://www.riverbankcomputing.co.uk/software/pyqt/intro">pyqt</a>
        官方网站</p>

<pre><code>-   书籍请google: pyqt book or qt book

-   中文资料: [qteverywhere](http://www.qteverywhere.com/)
</code></pre></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/fair-game/">所谓的你情我愿</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-29T22:18:18+08:00" pubdate data-updated="true">Oct 29<span>th</span>, 2010</time>
        
         | <a href="/blog/fair-game/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://lh3.ggpht.com/_os_zrveP8Ns/TMrZRW4Tz1I/AAAAAAAADLM/XC66Y6vsz4I/s800/W020080904536416398854.jpg" alt="image" /></p>

<p>今天看到帖子:
<a href="http://www.douban.com/note/97807441">http://www.douban.com/note/97807441</a>/
, 带来不少争议, 一句两句说不清楚, 特此专门发文阐述.</p>

<p>全文转载:</p>

<blockquote><p>今天跟某留学海外的经济学高材博士生简短对话，是从去沃尔玛买东西是不是不道德开始的（其实我也是去沃尔玛的，所以完全没有任何道德优越感）。</p>

<p>我说起有个纪录片是控诉沃尔玛的。她骤然很激动，说最受不了的就是这种了，这是你情我愿的事情，你既然接受了这工作，就没什么好抱怨的。</p>

<p>我对经济学一窍不通，很傻很天真的问：那不能老板拿少点，给员工多一点吗？</p>

<p>她说：你凭什么要让老板少拿呢？</p>

<p>我说：那你凭什么不让工人多拿呢？为什么老板不需要限制自己的欲望，而工人要限制自己的欲望呢？</p>

<p>她说：这是你情我愿的事，你可以到别的地方去工作啊。</p></blockquote>

<p>转载完了. 你支持哪一方?</p>

<p>作为一名普通人, 很少有机会能够以企业家的视角来思考问题,
往往是把自己带入到员工这个角色中, 感受员工的情绪:</p>

<ul>
<li>每天辛苦工作</li>
<li>拿到的工资却很少</li>
<li>会有被炒掉的危险</li>
</ul>


<p>但是, 作为一个明事理的人, 可以利用情绪来感受环境, 但是不能被情绪所左右,
不能成为情绪的奴隶, 在思考问题的时候, 要静下心来, 想清楚, 弄明白.</p>

<p><strong>先看清楚问题</strong>: 员工工作辛苦, 企业家是不是应该给员工更多的好处?
是不是应该给员工更多的保障?</p>

<p>我们眼中的很多企业家, 往往一毛不拔, 压榨员工, 给我们一个很不好的印象,
并且, 我们从小就得到教育: 企业家是靠榨取剩余价值来获得利润的.
但是我们有没有想过, 事实是不是这样?</p>

<p>回到真实世界. 如果你有观察过做小生意的人, 一开始都是自己辛苦工作,
然后摊子做大, 人手不够, 再去雇人. 因为成本因素, 会去让员工努力工作.
如果你做过生意, 应当知道: <strong>雇人不好雇</strong>: 工资少了人不来,
不去监管人偷懒.</p>

<p>我们都认为企业家剥削员工, 那么有没有见过:<strong>员工剥削企业家</strong>?
作为员工的自己, 是不是找到机会就会偷懒? 是不是能多拿点工资就多拿?
从不会期望减少工资? 想想.</p>

<p>现在回到沃尔玛. 假如世界上没有沃尔玛, 那么原先那些沃尔玛的员工,
是不是更不好找工作? 是不是有人强迫他们去沃尔玛工作, 有了沃尔玛,
他们是不是多了更多的工作机会, <strong>多了更多的选择</strong>?</p>

<p>再进一步. 在沃尔玛雇用员工之前, 对员工有没有义务?
雇用之后是不是有义务了? 这个义务是否是交换员工的服务?
在雇用员工的合约签订的时候, 员工是否有自主权? 如果待遇少了,
员工是不是能不签合约? 签了合约, 员工是不是应该服务以换取企业给的薪资,
是不是说, 既然签订了合约, 就是员工和企业家达成了:<strong>公平交易</strong>?</p>

<p>那么回到最开始的问题: 员工工作辛苦, 企业家是不是应该给员工更多的好处?
是不是应该给员工更多的保障?</p>

<p>如果说当初员工签约的时候已经是公平交易了, 那么为什么企业家应该付出更多?
这样是不是不公平? 为什么我们会希望这样的事情? 是不是因为情绪的影响?
还是什么其他更重要的原因?</p>

<p>这是我们每个人都应该想, 并且应该想清楚的问题,
这关乎我们的人生观和世界观, 虽然不会有直接的影响,
但是会潜移默化到我们自己将来会走的路, 甚至影响到其他人走的路.</p>

<p>如果你想要弄清楚这些问题, 应该看看张五常的
<a href="http://book.douban.com/subject/1394399/">经济解释</a> , 以及曼昆的:
<a href="http://book.douban.com/subject/1028842/">经济学原理</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/pyqt-publish/">Pyqt编写的程序如何发布</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-29T21:06:18+08:00" pubdate data-updated="true">Oct 29<span>th</span>, 2010</time>
        
         | <a href="/blog/pyqt-publish/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>2009年12月3号研究了一下如何发布pyqt的程序，整理内容如下：</p>

<p>pyqt是qt图形库对于python编程语言的一个绑定，qt是著名的跨平台图形开发库，专业，易用，以及企业级别支持，文档齐全。python是一个简单易用的解释语言。不过这篇文章是关于如何发布pyqt程序的，那么读者应该都知道这些，我就不多介绍了。</p>

<p>我们用pyqt开发完程序的时候，得到的是一堆python源代码，以及一些资源文件，比如用到的图片，声音什么的。程序在我们开发平台上可以运行，但是我们还需要想办法让客户机也能够用我们的代码。</p>

<p>我们需要做2件事情：一个是把源代码打包成可以放到任何电脑都能够执行的程序，另一个是做一个安装程序，好方便安装到客户机上。</p>

<p>我现在选择py2exe作为打包的工具，nsis作为生成安装程序的工具。</p>

<p>py2exe</p>

<ul>
<li><a href="http://www.cppblog.com/len/archive/2008/08/11/58547.html">py2exe教程1</a></li>
<li><a href="http://www.py2exe.org/index.cgi/Tutorial">py2exe官方教程</a></li>
<li><a href="http://sourceforge.net/projects/py2exe/files/">py2exe下载</a></li>
</ul>


<p>nsis</p>

<ul>
<li><a href="http://www.52z.com/soft/16497.html">nsis教程</a></li>
<li><a href="http://nsis.sourceforge.net/Simple_tutorials">nsis官方教程</a></li>
<li><a href="http://nsis.sourceforge.net/Download">nsis下载</a></li>
</ul>


<p>nsis下载后文档中有详细的介绍，安装目录中含有许多的示例。</p>

<p>我写的示例在
<a href="http://dl.dropbox.com/u/1167873/others/test_pyqt.zip">这里</a></p>

<p>稍微解释一下：
比如，我写了一个新的专案，名称叫test_pyqt，新建了一个这样的文件夹。
里面有一个main.py源代码。同时还有一个res的资源目录。
为了能够利用py2exe打包，需要新建一个setup.py的设置文件。</p>

<p>几个难点整理如下：
根据py2exe里面说的，pyqt需要包含sip（我也不知道这是什么东西，估计是C++转python的时候要用到的。。），下面的脚本含有具体的设置。
编译好的文件还需要一些额外的dll文件（主要是针对没有加sp的XP版本运行时出现“程序出错”报错的状况），放在dll文件夹里面，打包的时候要加上（dll文件在上面的示例中）。我没有研究出如何把这些文件加到可执行文件里面的办法，如果你知道的话，就告诉我。</p>

<p>内容如下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="ch">#!/usr/bin/env python</span>
</span><span class='line'><span class="c1">#-*- coding:utf-8 -*-</span>
</span><span class='line'><span class="c1"># ---------------------------------</span>
</span><span class='line'><span class="c1"># 打包程序</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">py2exe</span><span class="o">,</span><span class="nn">glob</span>
</span><span class='line'>
</span><span class='line'><span class="n">setup</span><span class="p">(</span><span class="n">windows</span><span class="o">=</span><span class="p">[{</span>
</span><span class='line'>                <span class="s2">&quot;script&quot;</span><span class="p">:</span> <span class="s1">&#39;main.py&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="c1">#应用程序图标</span>
</span><span class='line'>                <span class="s2">&quot;icon_resources&quot;</span><span class="p">:[(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;res/py.ico&quot;</span><span class="p">)]</span> <span class="p">}],</span>
</span><span class='line'>      <span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
</span><span class='line'>                  <span class="c1">#资源文件</span>
</span><span class='line'>                  <span class="p">(</span><span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;res/*.*&quot;</span><span class="p">)),</span>
</span><span class='line'>                  <span class="c1">#因为客户机可能缺少部分开发文件造成无法运行程序，需要打包一些文件</span>
</span><span class='line'>                  <span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;dlls/*.*&quot;</span><span class="p">)),</span>
</span><span class='line'>                  <span class="p">],</span>
</span><span class='line'>      <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;py2exe&quot;</span><span class="p">:{</span><span class="s2">&quot;includes&quot;</span><span class="p">:[</span><span class="s2">&quot;sip&quot;</span><span class="p">],</span>
</span><span class='line'>                         <span class="s2">&quot;optimize&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                         <span class="c1">#打包成一个文件，加快读取速度</span>
</span><span class='line'>                         <span class="s2">&quot;compressed&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
</span><span class='line'>                         <span class="s2">&quot;bundle_files&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                         <span class="c1">#文件放在哪里</span>
</span><span class='line'>                         <span class="s2">&quot;dist_dir&quot;</span><span class="p">:</span><span class="s2">&quot;temp/dist&quot;</span><span class="p">,</span>
</span><span class='line'>                         <span class="c1">#少了个文件,不管它</span>
</span><span class='line'>                         <span class="s2">&quot;dll_excludes&quot;</span><span class="p">:[</span><span class="s2">&quot;MSVCP90.dll&quot;</span><span class="p">],</span>
</span><span class='line'>                         <span class="p">},</span>
</span><span class='line'>               <span class="p">},</span>
</span><span class='line'>      <span class="n">zipfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,)</span><span class="c1">#一个文件</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#删除build临时目录</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">shutil</span>
</span><span class='line'><span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>执行:</p>

<pre><code>python setup.py py2exe
</code></pre>

<p>以上语句需要把python的目录加到path里面去，或者你可以在python前加上完整的python安装目录.
我是加path的，因为这样使用python更方便。</p>

<p>之后，会生成temp/dist文件夹，里面就是一个main.exe可执行文件了，还有res文件夹。</p>

<p>之后是生成安装文件，新建一个installer.nsi文件，内容如下（因为比较长，放到最后）。</p>

<p>内容比较多。当时我在做的时候，看了很多的文档才知道具体怎么做。为了方便，你还是用我的示例吧。</p>

<p>下面的内容含有多语言，license页面，安装内容页面，安装目录页面，以及反安装页面。</p>

<p>如果你感兴趣的话可以自己研究，我是被nsis细节给累倒了。</p>

<p>这个文件你只需要改下面软件名称的部分，它会自动把dist打包安装到program
files里面，生成执行文件链接到桌面以及菜单项中。</p>

<p>对了，主执行文件的入口是main.py这个源代码。</p>

<p>文件写好后，鼠标右键菜单中有一个compile nsis
script的选项，点击就可以生成安装文件。</p>

<p>具体的细节可以看我上面示例的压缩文档。我写了一个makefile来方便快速执行操作（别告诉我你不会用make）。
该示例在windows
xp,python2.6,nsis2.46,pyqt4.5,py2exe上测试通过。等以后考虑跨平台版本:</p>

<pre><code>#coding:utf-8

;软件名称
!define NAME "test_pyqt"

;主执行文件
!define EXE "dist\main.exe"

;样式
XPstyle on

;输出的安装文件
OutFile "temp/${NAME}_installer.exe"

;默认目录
InstallDir $PROGRAMFILES\${NAME}

; 检查是否已经安装过
InstallDirRegKey HKLM "Software\${NAME}" "Install_Dir"

;需要管理员权限
RequestExecutionLevel admin

;--------------------------------

; 页面

Page license
Page components
Page directory
Page instfiles

UninstPage uninstConfirm
UninstPage instfiles

;--------------------------------

; 安装主目录
Section "main"

SectionIn RO

; Set output path to the installation directory.
SetOutPath $INSTDIR

; 需要安装的程序
File /r "temp\dist"

; Write the installation path into the registry
WriteRegStr HKLM SOFTWARE\${NAME} "Install_Dir" "$INSTDIR"

; Write the uninstall keys for Windows
WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${NAME}" "DisplayName" "${NAME}"
WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${NAME}" "UninstallString" '"$INSTDIR\uninstall.exe"'
WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${NAME}" "NoModify" 1
WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\${NAME}" "NoRepair" 1
WriteUninstaller "uninstall.exe"

SectionEnd

; 开始菜单
Section "开始菜单"

CreateDirectory "$SMPROGRAMS\${NAME}"
CreateShortCut "$SMPROGRAMS\${NAME}\Uninstall.lnk" "$INSTDIR\uninstall.exe" "" "$INSTDIR\uninstall.exe" 0
SetOutPath $INSTDIR\dist
CreateShortCut "$SMPROGRAMS\${NAME}\${NAME}.lnk" "$INSTDIR\${EXE}" "" "$INSTDIR\${EXE}" 0

SectionEnd

; 桌面快捷方式
Section "桌面快捷方式"
SetOutPath $INSTDIR\dist
CreateShortCut "$DESKTOP\${NAME}.lnk" "$INSTDIR\${EXE}" "" "$INSTDIR\${EXE}" 0
SectionEnd

;--------------------------------

; Uninstaller

Section "Uninstall"

; Remove registry keys
DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\"
DeleteRegKey HKLM SOFTWARE\${NAME}

; Remove directories used
Delete "$DESKTOP\${NAME}.lnk"
RMDir /r "$SMPROGRAMS\${NAME}"
RMDir /r "$INSTDIR"

SectionEnd

;--------------------------------
; 语言部分
; First is default
LoadLanguageFile "${NSISDIR}\Contrib\Language files\English.nlf"
LoadLanguageFile "${NSISDIR}\Contrib\Language files\SimpChinese.nlf"

; License data
; Not exactly translated, but it shows what's needed
LicenseLangString myLicenseData ${LANG_ENGLISH} "license.txt"
LicenseLangString myLicenseData ${LANG_SIMPCHINESE} "license.txt"
LicenseData $(myLicenseData)

; Set name using the normal interface (Name command)
; LangString Name ${LANG_ENGLISH} "English"
; LangString Name ${LANG_SIMPCHINESE} "Simplified Chinese"
; Name $(Name)

;--------------------------------
Function .onInit

;Language selection dialog

Push ""
Push ${LANG_ENGLISH}
Push English
Push ${LANG_SIMPCHINESE}
Push "Simplified Chinese"
Push A ; A means auto count languages
; for the auto count to work the first empty push (Push "") must remain
LangDLL::LangDialog "Installer Language" "Please select the language of the installer"

Pop $LANGUAGE
StrCmp $LANGUAGE "cancel" 0 +2
Abort
FunctionEnd
[/sourcecode]
</code></pre>

<p>2010/10/29修改: 其实现在pyinstaller用起来更方便, 直接build就可以了.
python2.6以后的版本需要下载开发版本使用.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/realpeople-steampunk/">真人蒸汽朋克</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-29T20:50:54+08:00" pubdate data-updated="true">Oct 29<span>th</span>, 2010</time>
        
         | <a href="/blog/realpeople-steampunk/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://www.riesetheseries.com/html/images/img_sypnopsis.jpg" alt="image" /></p>

<p>想看就点 <a href="http://www.riesetheseries.com/html/episodes.html">这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/python-draw-landscape/">用python画地形图</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-29T20:49:17+08:00" pubdate data-updated="true">Oct 29<span>th</span>, 2010</time>
        
         | <a href="/blog/python-draw-landscape/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>看到一篇
<a href="http://www.cnblogs.com/lookof/archive/2009/03/18/1415259.html">好文</a>,关于如何生成一个随机地形图的，
方法是用分形。于是手痒，花了一个下午和半个上午的时间把用python把这个事给干了。
下面是生成的2维和3维效果，代码在
<a href="http://dl.dropbox.com/u/1167873/others/landscape.zip">这里</a></p>

<p><img src="http://lh4.ggpht.com/_os_zrveP8Ns/TMrCRfPwMlI/AAAAAAAADLA/kuDfiF_zYb0/s800/screenshot-figure-1.png" alt="image" />
<img src="http://lh6.ggpht.com/_os_zrveP8Ns/TMrCRlQ9yJI/AAAAAAAADLE/t7EUtx1vodY/s800/screenshot-figure-1-1.png" alt="image" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/ways-to-rome/">回的四种写法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-29T20:42:05+08:00" pubdate data-updated="true">Oct 29<span>th</span>, 2010</time>
        
         | <a href="/blog/ways-to-rome/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>2010/5/30聚会，沈大侠分享了一下python dict get的四种方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="c1"># method 1</span>
</span><span class='line'><span class="c1"># 采用异常捕捉来处理KeyError</span>
</span><span class='line'><span class="c1"># 查询1次</span>
</span><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'><span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># method 2</span>
</span><span class='line'><span class="c1"># 取值前先进行条件判断</span>
</span><span class='line'><span class="c1"># 查询2次</span>
</span><span class='line'><span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'><span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># method 3</span>
</span><span class='line'><span class="c1"># 和method2类似，只是利用in取代函数调用</span>
</span><span class='line'><span class="c1"># 查询2次</span>
</span><span class='line'><span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'><span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># method 4</span>
</span><span class='line'><span class="c1"># 函数调用</span>
</span><span class='line'><span class="c1"># 查询1次</span>
</span><span class='line'><span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>    <span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span></code></pre></td></tr></table></div></figure>


<p>提到几点： 函数调用是比较慢的，不如data[key]和key in data快。
所以method2完全可以被method3替代。 method4在多数情况下也没有method2好。</p>

<p>异常处理因为需要建立Error的对象，是最慢的。
所以method1不很适用命中率低的状况。</p>

<p>method1和method4都只查询一次， method2和method3都要查询两次，
在某些查询是性能瓶颈的时候，不如method1和2快。</p>

<p>为了对上面的估计作实际验证，我写了测试程序，如下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span></span><span class="ch">#!/usr/bin/env python</span>
</span><span class='line'><span class="c1">#-*- coding:utf-8 -*-</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">json</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span class='line'>    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span class='line'>        <span class="c1">#method 1</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span class='line'>            <span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;method 1 spend time: </span><span class="si">%f</span><span class="s2"> s.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>    <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span class='line'>        <span class="c1">#method 2</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span class='line'>            <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;method 2 spend time: </span><span class="si">%f</span><span class="s2"> s.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>    <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span class='line'>        <span class="c1">#method 3</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'>            <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;method 3 spend time: </span><span class="si">%f</span><span class="s2"> s.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>    <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span class='line'>        <span class="c1">#method 4</span>
</span><span class='line'>        <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>            <span class="n">v</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;method 4 spend time: </span><span class="si">%f</span><span class="s2"> s.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>    <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">times</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;test hit&quot;</span>
</span><span class='line'>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
</span><span class='line'>    <span class="n">k</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
</span><span class='line'>    <span class="n">times1</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;test not hit&quot;</span>
</span><span class='line'>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
</span><span class='line'>    <span class="n">k</span> <span class="o">=</span> <span class="s1">&#39;ab&#39;</span>
</span><span class='line'>    <span class="n">times2</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="s2">&quot;test data IO&quot;</span>
</span><span class='line'>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
</span><span class='line'>    <span class="n">k</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
</span><span class='line'>    <span class="n">fd</span> <span class="o">=</span> <span class="n">FileDict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">times3</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span>
</span><span class='line'>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</span><span class='line'>    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>    <span class="n">p1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">times1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">p2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">times2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">p3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ind</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">times3</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;method 1&#39;</span><span class="p">,</span> <span class="s1">&#39;method 2&#39;</span><span class="p">,</span> <span class="s1">&#39;method 3&#39;</span><span class="p">,</span> <span class="s1">&#39;method 4&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;not hit&#39;</span><span class="p">,</span> <span class="s1">&#39;IO&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">FileDict</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp.txt&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp.txt&#39;</span><span class="p">))[</span><span class="n">key</span><span class="p">]</span>
</span><span class='line'>    <span class="fm">__getitem__</span> <span class="o">=</span> <span class="n">get</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp.txt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>    <span class="fm">__contains__</span> <span class="o">=</span> <span class="n">has_key</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>结果如图 (ubuntu9.10 + python2.6):</p>

<p><img src="http://lh6.ggpht.com/_os_zrveP8Ns/TMrAxqHFJwI/AAAAAAAADK4/1aJhy9uAV_w/s800/Screenshot-Figure%201-2.png" alt="image" />
method3性能比method2好，method1在not hit的情况下时间消耗最多，
在get消耗大的情况下method1和method4消耗的时间要比method2和method3少一半。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/29/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/27/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/radio-useless/">收音机没啥用了</a>
      </li>
    
      <li class="post">
        <a href="/blog/ipkvm/">低成本IPKVM控制多台主机</a>
      </li>
    
      <li class="post">
        <a href="/blog/bed-car/">床车方案</a>
      </li>
    
      <li class="post">
        <a href="/blog/car-air-conditioner/">床车空调方案</a>
      </li>
    
      <li class="post">
        <a href="/blog/work-in-car/">车作为第二空间</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/halida">@halida</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'halida',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2024 - 机械唯物主义 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'halidasvps';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>
